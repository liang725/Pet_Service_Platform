const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D7KbY98F.js","assets/index-CNnu_hxC.css"])))=>i.map(i=>d[i]);
import{z as D,r as i,u as A,c as v,y as d,A as b}from"./index-D7KbY98F.js";const q=D("pet",()=>{const s=i([]),p=i(null),o=i(!1),a=i(""),u=A(),h=async()=>{o.value=!0,a.value="";try{const t=await d({url:"/api/pets",method:"GET"});if(t.code===200)s.value=t.data||[];else throw new Error(t.message)}catch(t){console.error("获取宠物列表失败:",t),a.value=t.message,w()}finally{o.value=!1}},w=()=>{s.value=[{id:1,name:"巧克力",petType:"狗",breed:"金毛寻回犬",gender:"公",birthDate:"2020-06-15",color:"金色",weight:28,personality:"温顺、友好、贪吃",notes:"喜欢玩接球游戏，每天需要散步两次，对小朋友特别友善。",createdAt:"2023-01-01T10:00:00"},{id:2,name:"棉花糖",petType:"猫",breed:"布偶猫",gender:"母",birthDate:"2021-08-10",color:"白色带棕色斑点",weight:4.5,personality:"温顺、粘人、安静",notes:"喜欢被抚摸下巴，不喜欢独处，每天需要梳理毛发。",createdAt:"2023-02-15T14:30:00"}]},g=async t=>{o.value=!0,a.value="";try{const e=await d({url:`/api/pets/${t}`,method:"GET"});if(e.code===200)p.value=e.data;else throw new Error(e.message)}catch(e){throw console.error("获取宠物详情失败:",e),a.value=e.message,e}finally{o.value=!1}},m=async t=>{o.value=!0,a.value="";try{const{default:e}=await b(async()=>{const{default:c}=await import("./index-D7KbY98F.js").then(f=>f.P);return{default:c}},__vite__mapDeps([0,1])),r=u.userInfo?.id;if(!r)throw console.error("用户ID获取失败:",{userInfo:u.userInfo,user:u.user}),new Error("用户未登录，无法添加宠物");console.log("添加宠物 - 用户ID:",r);const l={...t,userId:parseInt(r)};console.log("添加宠物 - 请求数据:",l);const n=await e({url:"/api/pets",method:"POST",data:l});if(n.code===200)return await h(),n.data;throw new Error(n.message)}catch(e){throw console.error("添加宠物失败:",e),a.value=e.message,e}finally{o.value=!1}},y=async(t,e)=>{o.value=!0,a.value="";try{const r=u.userInfo?.id;if(!r)throw console.error("用户ID获取失败:",{userInfo:u.userInfo,user:u.user}),new Error("用户未登录，无法更新宠物信息");console.log("更新宠物 - 用户ID:",r);const l={...e,userId:parseInt(r)};console.log("更新宠物 - 请求数据:",l);const n=await d({url:`/api/pets/${t}`,method:"PUT",data:l});if(n.code===200){p.value=n.data;const c=s.value.findIndex(f=>f.id===t);return c!==-1&&(s.value[c]={...s.value[c],...e}),n.data}else throw new Error(n.message)}catch(r){throw console.error("更新宠物失败:",r),a.value=r.message,r}finally{o.value=!1}},I=async t=>{o.value=!0,a.value="";try{const e=await d({url:`/api/pets/${t}`,method:"DELETE"});if(e.code===200){const r=s.value.findIndex(l=>l.id===t);r!==-1&&s.value.splice(r,1)}else throw new Error(e.message)}catch(e){throw console.error("删除宠物失败:",e),a.value=e.message,e}finally{o.value=!1}},P=async()=>{try{return(await d({url:"/api/pets/count",method:"GET"})).data?.count||0}catch(t){return console.error("获取宠物数量失败:",t),s.value.length}},E=v(()=>s.value.length>0),T=v(()=>s.value.length);return{pets:s,currentPet:p,loading:o,error:a,fetchUserPets:h,fetchPetDetail:g,addPet:m,updatePet:y,deletePet:I,getPetCount:P,getPetTypeIcon:t=>{const e={狗:"mdi:dog",猫:"mdi:cat",兔兔:"mdi:rabbit",小鸟:"mdi:bird",其他:"mdi:paw"};return e[t]||e.其他},getPetTypeColor:t=>{const e={狗:"#8B7355",猫:"#FF9A3C",兔兔:"#FFB6C1",小鸟:"#87CEEB",其他:"#A0A0A0"};return e[t]||e.其他},hasPets:E,petCount:T}});export{q as u};
