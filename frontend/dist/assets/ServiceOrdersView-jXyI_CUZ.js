import{_ as ue,u as ve,r as f,c as P,o as fe,d as r,e as t,h as k,f as pe,l as d,E as B,g as me,n as p,t as o,i as T,v as z,D as E,G as ge,F as C,s as x,k as be,m as ye,p as i}from"./index-D7KbY98F.js";const he={class:"service-orders"},ke={class:"orders-header"},_e={class:"stats-cards"},De={class:"stat-content"},we={class:"stat-number"},Se={class:"stat-content"},Me={class:"stat-number"},Ce={class:"stat-content"},Ae={class:"stat-number"},Ne={class:"stat-content"},Ie={class:"stat-number"},$e={class:"filters-section"},Te={class:"search-box"},xe={class:"filter-options"},Ve=["value"],Fe={class:"orders-tabs"},Pe=["onClick"],Oe={key:0,class:"badge"},Le={class:"orders-list"},Ue={key:0,class:"loading-state"},Re={key:1,class:"empty-state"},Ye={key:0},je={key:1},Be={key:2},ze={key:2,class:"appointments-grid"},Ee={class:"card-header"},Ge={class:"order-info"},He={class:"order-no"},Ke={class:"order-date"},We={class:"card-body"},qe={class:"service-info"},Je={class:"service-icon"},Qe={class:"service-details"},Xe={class:"pet-info"},Ze={class:"pet-avatar"},et={class:"pet-name"},tt={class:"pet-type"},st={class:"service-price"},at={key:0,class:"special-notes"},lt={class:"card-footer"},nt={class:"created-time"},ot={class:"card-actions"},it=["onClick"],rt=["onClick"],ct={key:3,class:"pagination"},dt=["disabled"],ut=["onClick"],vt=["disabled"],ft={class:"page-info"},pt={key:0,class:"modal-overlay"},mt={class:"modal-content"},gt={class:"modal-body"},bt={class:"cancel-details"},yt={class:"cancel-reason"},ht={class:"char-count"},kt={class:"modal-footer"},O=10,_t={__name:"ServiceOrdersView",setup(Dt){const G=ye(),A=ve(),H=[{value:"pending",label:"待服务"},{value:"confirmed",label:"已确认"},{value:"completed",label:"已完成"},{value:"cancelled",label:"已取消"},{value:"all",label:"全部"}],c=f("pending"),V=f(!1),N=f([]),L=f([]),m=f({}),_=f(""),D=f(""),w=f(""),u=f(1),I=f(!1),b=f(null),S=f(""),U=P(()=>{let a=[...N.value];if(c.value!=="all"&&(a=a.filter(s=>s.status===c.value)),_.value){const s=_.value.toLowerCase();a=a.filter(l=>l.orderNo.toLowerCase().includes(s)||l.petName.toLowerCase().includes(s)||l.serviceName.toLowerCase().includes(s))}if(D.value){const s=new Date;a=a.filter(l=>{const v=new Date(l.appointmentDate);switch(D.value){case"today":return v.toDateString()===s.toDateString();case"week":const g=new Date(s.setDate(s.getDate()-s.getDay()));return v>=g;case"month":return v.getMonth()===s.getMonth()&&v.getFullYear()===s.getFullYear();case"last-month":const h=new Date(s.getFullYear(),s.getMonth()-1,1),$=new Date(s.getFullYear(),s.getMonth(),0);return v>=h&&v<=$;default:return!0}})}w.value&&(a=a.filter(s=>s.petId===parseInt(w.value)));const e=(u.value-1)*O,n=e+O;return a.slice(e,n)}),y=P(()=>Math.ceil(N.value.length/O)),K=P(()=>{const a=[];if(y.value<=5)for(let n=1;n<=y.value;n++)a.push(n);else{let n=Math.max(1,u.value-2),s=Math.min(y.value,n+5-1);s-n+1<5&&(n=s-5+1);for(let l=n;l<=s;l++)a.push(l)}return a});function W(a){return{pending:"待服务预约",confirmed:"已确认预约",completed:"已完成预约",cancelled:"已取消预约",all:"预约记录"}[a]||"预约"}function q(a){return{pending:"待服务",confirmed:"已确认",completed:"已完成",cancelled:"已取消"}[a]||a}function J(a){return a.includes("洗澡")?"fas fa-shower":a.includes("美容")?"fas fa-cut":a.includes("SPA")||a.includes("护理")?"fas fa-spa":a.includes("驱虫")?"fas fa-bug":"fas fa-paw"}function Q(a){return a==="狗"?"fas fa-dog":"fas fa-cat"}function R(a){if(!a)return"";const e=new Date(a),n=e.getMonth()+1,s=e.getDate();return`${n}月${s}日`}function X(a){if(!a)return"";const e=new Date(a),n=e.getMonth()+1,s=e.getDate(),l=e.getHours().toString().padStart(2,"0"),v=e.getMinutes().toString().padStart(2,"0");return`${n}月${s}日 ${l}:${v}`}async function M(){V.value=!0;try{console.log("开始获取预约列表...");const[a,e]=await Promise.all([A.getAllUserAppointments(),A.getAppointmentStats()]);console.log("预约列表原始数据:",a),console.log("统计原始数据:",e);let n=[];Array.isArray(a)?n=a:a&&typeof a=="object"&&(Array.isArray(a.data)?n=a.data:a.list&&(n=a.list)),n=n.map(l=>({id:parseInt(l.id)||l.id,orderNo:l.orderNo||`ORD-${new Date().getTime()}`,petId:parseInt(l.petId)||l.petId,petName:l.petName||l.pet?.name||"未命名",petType:l.petType||l.pet?.type||"未知",serviceName:l.serviceName||l.service?.name||"未知服务",appointmentDate:l.appointmentDate||new Date().toISOString().split("T")[0],timeSlot:l.timeSlot||"09:00",orderTotalAmount:parseFloat(l.orderTotalAmount)||parseFloat(l.totalAmount)||0,specialNotes:l.specialNotes||"",status:l.status||"pending",createdAt:l.createdAt||new Date().toISOString()})),console.log("格式化后预约数据:",n),N.value=n;let s={};e&&typeof e=="object"&&(e.data&&typeof e.data=="object"?s=e.data:s=e),m.value={pending:parseInt(s.pending)||0,confirmed:parseInt(s.confirmed)||0,completed:parseInt(s.completed)||0,cancelled:parseInt(s.cancelled)||0,all:parseInt(s.all)||n.length},console.log("最终统计:",m.value)}catch(a){console.error("获取预约列表失败:",a),N.value=Y(),ce()}finally{V.value=!1}}async function Z(){try{L.value=await A.getUserPets()}catch(a){console.error("获取宠物列表失败:",a)}}function ee(a){c.value=a,u.value=1}function te(a){G.push(`/service/appointment/${a}`)}function se(a){b.value=a,S.value="",I.value=!0}async function ae(){if(b.value)try{await A.cancelAppointment(b.value.id,S.value||"用户主动取消"),I.value=!1,alert("预约已取消"),await M()}catch(a){console.error("取消预约失败:",a),alert(a.message||"取消预约失败")}}function le(){_.value="",D.value="",w.value="",u.value=1,M()}function ne(){u.value=1}function oe(){u.value>1&&u.value--}function ie(){u.value<y.value&&u.value++}function re(a){u.value=a}function Y(){const a=[{name:"基础洗澡",price:80,category:"洗澡"},{name:"精致洗护",price:102,category:"洗澡"},{name:"基础美容",price:150,category:"美容"},{name:"SPA护理",price:160,category:"护理"}],e=[{id:1,name:"旺财",type:"狗"},{id:2,name:"咪咪",type:"猫"}],n=["pending","confirmed","completed","cancelled"],s=["09:00","10:30","14:00","15:30","17:00"],l=[],v=new Date;for(let g=0;g<15;g++){const h=Math.floor(Math.random()*30),$=new Date;$.setDate(v.getDate()-h+(g<5?3:0));const j=a[Math.floor(Math.random()*a.length)],F=e[Math.floor(Math.random()*e.length)],de=n[Math.floor(Math.random()*n.length)];l.push({id:g+1,orderNo:`ORD-${v.getFullYear()}${String(v.getMonth()+1).padStart(2,"0")}${String(v.getDate()).padStart(2,"0")}-${String(g+1).padStart(3,"0")}`,petId:F.id,petName:F.name,petType:F.type,serviceName:j.name,appointmentDate:$.toISOString().split("T")[0],timeSlot:s[Math.floor(Math.random()*s.length)],orderTotalAmount:j.price,specialNotes:Math.random()>.7?"对某些洗护用品过敏，请使用天然产品":null,status:de,createdAt:new Date(Date.now()-h*24*60*60*1e3).toISOString()})}return l.sort((g,h)=>new Date(h.appointmentDate)-new Date(g.appointmentDate))}function ce(){const a=Y();m.value={pending:a.filter(e=>e.status==="pending").length,confirmed:a.filter(e=>e.status==="confirmed").length,completed:a.filter(e=>e.status==="completed").length,cancelled:a.filter(e=>e.status==="cancelled").length,all:a.length}}return fe(()=>{M(),Z()}),(a,e)=>{const n=me("router-link");return i(),r(C,null,[t("div",he,[t("div",ke,[e[10]||(e[10]=t("div",null,[t("h1",null,[t("i",{class:"fas fa-list-alt"}),d(" 我的预约")]),t("p",{class:"subtitle"},"查看和管理您的所有预约记录")],-1)),pe(n,{to:"/service/appointment",class:"btn-new-appointment"},{default:B(()=>[...e[9]||(e[9]=[t("i",{class:"fas fa-plus"},null,-1),d(" 新预约 ",-1)])]),_:1})]),t("div",_e,[t("div",{class:p(["stat-card",{active:c.value==="pending"}]),onClick:e[0]||(e[0]=s=>c.value="pending")},[e[12]||(e[12]=t("div",{class:"stat-icon pending"},[t("i",{class:"fas fa-clock"})],-1)),t("div",De,[t("div",we,o(m.value.pending||0),1),e[11]||(e[11]=t("div",{class:"stat-label"},"待服务",-1))])],2),t("div",{class:p(["stat-card",{active:c.value==="confirmed"}]),onClick:e[1]||(e[1]=s=>c.value="confirmed")},[e[14]||(e[14]=t("div",{class:"stat-icon confirmed"},[t("i",{class:"fas fa-check-circle"})],-1)),t("div",Se,[t("div",Me,o(m.value.confirmed||0),1),e[13]||(e[13]=t("div",{class:"stat-label"},"已确认",-1))])],2),t("div",{class:p(["stat-card",{active:c.value==="completed"}]),onClick:e[2]||(e[2]=s=>c.value="completed")},[e[16]||(e[16]=t("div",{class:"stat-icon completed"},[t("i",{class:"fas fa-check-double"})],-1)),t("div",Ce,[t("div",Ae,o(m.value.completed||0),1),e[15]||(e[15]=t("div",{class:"stat-label"},"已完成",-1))])],2),t("div",{class:p(["stat-card",{active:c.value==="cancelled"}]),onClick:e[3]||(e[3]=s=>c.value="cancelled")},[e[18]||(e[18]=t("div",{class:"stat-icon cancelled"},[t("i",{class:"fas fa-times-circle"})],-1)),t("div",Ne,[t("div",Ie,o(m.value.cancelled||0),1),e[17]||(e[17]=t("div",{class:"stat-label"},"已取消",-1))])],2)]),t("div",$e,[t("div",Te,[e[19]||(e[19]=t("i",{class:"fas fa-search"},null,-1)),T(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>_.value=s),type:"text",placeholder:"搜索订单号、宠物名称或服务项目...",onInput:ne},null,544),[[z,_.value]])]),t("div",xe,[T(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>D.value=s),class:"filter-select",onChange:M},[...e[20]||(e[20]=[ge('<option value="" data-v-8c15f1b9>所有日期</option><option value="today" data-v-8c15f1b9>今天</option><option value="week" data-v-8c15f1b9>本周</option><option value="month" data-v-8c15f1b9>本月</option><option value="last-month" data-v-8c15f1b9>上月</option>',5)])],544),[[E,D.value]]),T(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>w.value=s),class:"filter-select",onChange:M},[e[21]||(e[21]=t("option",{value:""},"所有宠物",-1)),(i(!0),r(C,null,x(L.value,s=>(i(),r("option",{key:s.id,value:s.id},o(s.name),9,Ve))),128))],544),[[E,w.value]]),t("button",{class:"btn-reset",onClick:le},[...e[22]||(e[22]=[t("i",{class:"fas fa-redo"},null,-1),d(" 重置 ",-1)])])])]),t("div",Fe,[(i(),r(C,null,x(H,s=>t("button",{key:s.value,class:p(["tab-btn",{active:c.value===s.value}]),onClick:l=>ee(s.value)},[d(o(s.label)+" ",1),m.value[s.value]?(i(),r("span",Oe,o(m.value[s.value]),1)):k("",!0)],10,Pe)),64))]),t("div",Le,[V.value?(i(),r("div",Ue,[...e[23]||(e[23]=[t("div",{class:"spinner"},[t("i",{class:"fas fa-spinner fa-spin"})],-1),t("p",null,"加载预约记录中...",-1)])])):U.value.length===0?(i(),r("div",Re,[e[25]||(e[25]=t("div",{class:"empty-icon"},[t("i",{class:"fas fa-calendar-times"})],-1)),t("h3",null,"暂无"+o(W(c.value)),1),c.value==="pending"?(i(),r("p",Ye," 您还没有预约记录，立即为您的爱宠预约服务吧！ ")):c.value==="completed"?(i(),r("p",je," 暂无已完成的服务记录 ")):(i(),r("p",Be," 暂无相关预约记录 ")),c.value==="pending"?(i(),be(n,{key:3,to:"/service/appointment",class:"btn-primary"},{default:B(()=>[...e[24]||(e[24]=[t("i",{class:"fas fa-plus"},null,-1),d(" 立即预约 ",-1)])]),_:1})):k("",!0)])):(i(),r("div",ze,[(i(!0),r(C,null,x(U.value,s=>(i(),r("div",{key:s.id,class:p(["appointment-card",s.status])},[t("div",Ee,[t("div",Ge,[t("div",He,[e[26]||(e[26]=t("i",{class:"fas fa-receipt"},null,-1)),d(" "+o(s.orderNo),1)]),t("div",{class:p(["status-badge",s.status])},o(q(s.status)),3)]),t("div",Ke,[e[27]||(e[27]=t("i",{class:"far fa-calendar"},null,-1)),d(" "+o(R(s.appointmentDate))+" "+o(s.timeSlot),1)])]),t("div",We,[t("div",qe,[t("div",Je,[t("i",{class:p(J(s.serviceName))},null,2)]),t("div",Qe,[t("h4",null,o(s.serviceName),1),t("div",Xe,[t("span",Ze,[t("i",{class:p(Q(s.petType))},null,2)]),t("span",et,o(s.petName),1),t("span",tt,o(s.petType),1)])]),t("div",st," ¥"+o(s.orderTotalAmount),1)]),s.specialNotes?(i(),r("div",at,[e[28]||(e[28]=t("i",{class:"fas fa-sticky-note"},null,-1)),t("span",null,o(s.specialNotes),1)])):k("",!0),t("div",lt,[t("div",nt," 创建时间："+o(X(s.createdAt)),1),t("div",ot,[t("button",{class:"btn-action view",onClick:l=>te(s.id)},[...e[29]||(e[29]=[t("i",{class:"fas fa-eye"},null,-1),d(" 查看详情 ",-1)])],8,it),s.status==="pending"?(i(),r("button",{key:0,class:"btn-action cancel",onClick:l=>se(s)},[...e[30]||(e[30]=[t("i",{class:"fas fa-times"},null,-1),d(" 取消 ",-1)])],8,rt)):k("",!0)])])])],2))),128))])),y.value>1?(i(),r("div",ct,[t("button",{disabled:u.value===1,onClick:oe,class:"page-btn"},[...e[31]||(e[31]=[t("i",{class:"fas fa-chevron-left"},null,-1)])],8,dt),(i(!0),r(C,null,x(K.value,s=>(i(),r("button",{key:s,class:p(["page-btn",{active:s===u.value}]),onClick:l=>re(s)},o(s),11,ut))),128)),t("button",{disabled:u.value===y.value,onClick:ie,class:"page-btn"},[...e[32]||(e[32]=[t("i",{class:"fas fa-chevron-right"},null,-1)])],8,vt),t("span",ft," 第 "+o(u.value)+" 页 / 共 "+o(y.value)+" 页 ",1)])):k("",!0)])]),I.value?(i(),r("div",pt,[t("div",mt,[e[39]||(e[39]=t("div",{class:"modal-header"},[t("i",{class:"fas fa-exclamation-triangle warning-icon"}),t("h3",null,"确认取消预约")],-1)),t("div",gt,[t("p",null,[e[33]||(e[33]=d("确定要取消预约 ",-1)),t("strong",null,o(b.value?.orderNo),1),e[34]||(e[34]=d(" 吗？",-1))]),t("div",bt,[t("p",null,[e[35]||(e[35]=t("i",{class:"fas fa-paw"},null,-1)),d(" 宠物："+o(b.value?.petName),1)]),t("p",null,[e[36]||(e[36]=t("i",{class:"fas fa-spa"},null,-1)),d(" 服务："+o(b.value?.serviceName),1)]),t("p",null,[e[37]||(e[37]=t("i",{class:"far fa-calendar"},null,-1)),d(" 时间："+o(R(b.value?.appointmentDate))+" "+o(b.value?.timeSlot),1)])]),t("div",yt,[e[38]||(e[38]=t("label",{for:"cancelReason"},[t("i",{class:"fas fa-comment-dots"}),d(" 取消原因（可选）： ")],-1)),T(t("textarea",{id:"cancelReason","onUpdate:modelValue":e[7]||(e[7]=s=>S.value=s),placeholder:"请告诉我们取消的原因...",rows:"3",maxlength:"200"},null,512),[[z,S.value]]),t("div",ht,o(S.value?.length||0)+"/200",1)])]),t("div",kt,[t("button",{class:"btn-secondary",onClick:e[8]||(e[8]=s=>I.value=!1)}," 再考虑一下 "),t("button",{class:"btn-danger",onClick:ae}," 确认取消 ")])])])):k("",!0)],64)}}},St=ue(_t,[["__scopeId","data-v-8c15f1b9"]]);export{St as default};
