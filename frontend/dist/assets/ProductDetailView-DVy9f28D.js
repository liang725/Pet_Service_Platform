import{_ as Q,H as A,r as u,c as I,B as O,o as U,d as l,e as s,h as m,f as j,t as o,F as r,s as d,l as h,i as y,v as G,n as f,J as w,w as K,E as W,T as X,b as Y,m as Z,p as n,x as $}from"./index-D7KbY98F.js";import{a as ss,b as ts}from"./product-Dg8M0DH-.js";const es={class:"product-detail-page"},as={class:"breadcrumb"},is={class:"container"},os={class:"breadcrumb-list"},ls={class:"container"},ns={class:"product-detail-container"},cs={class:"product-images"},rs={class:"main-image-container"},ds=["src","alt"],us={class:"product-info"},vs={class:"product-title"},_s={class:"product-subtitle"},ps={class:"product-meta"},ms={class:"rating"},hs={class:"stars"},fs={class:"rating-score"},gs={class:"rating-count"},bs={class:"sales"},ys={class:"price-section"},ks={class:"current-price"},ws={class:"original-price"},Cs={key:0,class:"spec-section"},xs={class:"spec-options"},qs=["onClick"],Is={class:"quantity-section"},Ps={class:"quantity-selector"},Ss=["max"],Ds={class:"stock-info"},Ts={key:0},Ms={class:"action-buttons"},Ns=["disabled"],$s=["disabled"],Vs={class:"service-guarantee"},Bs={class:"service-icon"},Rs={class:"service-text"},zs={class:"product-tabs"},Hs={class:"tab-headers"},Ls=["onClick"],Es={class:"tab-content"},Fs={class:"tab-pane"},Js=["innerHTML"],Qs={class:"tab-pane"},As={class:"spec-table"},Os={class:"tab-pane"},Us={class:"review-summary"},js={class:"overall-rating"},Gs={class:"rating-score-large"},Ks={class:"rating-stars-large"},Ws={class:"rating-distribution"},Xs={class:"rating-label"},Ys={class:"rating-progress"},Zs={class:"rating-percentage"},st={class:"review-list"},tt={class:"review-header"},et={class:"reviewer"},at={class:"review-date"},it={class:"review-rating"},ot={class:"review-content"},lt={class:"tab-pane"},nt={class:"feature-list"},ct={key:0,class:"recommended-products"},rt={class:"product-grid"},dt=["onClick"],ut=["src","alt"],vt={class:"info"},_t={class:"title"},pt={class:"price"},mt=["src"],ht={key:0,class:"notification"},ft={__name:"ProductDetailView",setup(gt){const C=Y(),x=Z(),V=A(),a=u({id:null,name:"加载中...",subtitle:"",rating:0,reviewCount:0,monthlySales:0,images:[],specifications:[],stock:0,maxPurchase:10,promotions:[],description:"",params:{},ratingDistribution:[],reviews:[],faqs:[]}),q=u([]),P=u(0),k=u(null),c=u(1),v=u("description"),S=u(!1),g=u({show:!1,message:""});u(null);const B=[{icon:"fas fa-shield-alt",text:"正品保证"},{icon:"fas fa-shipping-fast",text:"快速发货"},{icon:"fas fa-undo-alt",text:"七天退换"},{icon:"fas fa-headset",text:"专业客服"}],R=[{id:"description",label:"商品详情"},{id:"specifications",label:"规格参数"},{id:"reviews",label:I(()=>`商品评价 (${a.value.reviewCount})`)},{id:"qa",label:"常见问题"}],D=I(()=>a.value.images[P.value]||""),b=I(()=>a.value.specifications?.find(i=>i.id===k.value)||a.value.specifications?.[0]||{price:0,originalPrice:0}),T=(i,t)=>i<=Math.floor(t)?"fas fa-star":i===Math.ceil(t)&&t%1!==0?"fas fa-star-half-alt":"far fa-star",z=i=>{k.value=i},H=()=>{c.value>1&&c.value--},L=()=>{const i=a.value.maxPurchase||99;c.value<i&&c.value<a.value.stock&&c.value++},E=async()=>{if(a.value.stock!==0)try{await V.addItem({productId:a.value.id,spec:b.value.name||"标准装",quantity:c.value}),p(`成功添加 ${c.value} 件商品到购物车`)}catch(i){i.message==="请先登录"?(p("请先登录"),setTimeout(()=>{x.push("/auth")},1e3)):p("添加失败，请重试")}},F=()=>{if(a.value.stock===0)return;const i={id:a.value.id,name:a.value.name,image:a.value.images?.[0]||"",price:b.value.price,selectedSpec:b.value.name};x.push({path:"/checkout",query:{type:"direct",productId:a.value.id,quantity:c.value,product:JSON.stringify(i)}})},J=i=>{x.push(`/product/${i}`)},p=i=>{g.value.show=!0,g.value.message=i,setTimeout(()=>{g.value.show=!1},3e3)},M=async()=>{try{const i=C.params.id;if(console.log("正在加载商品详情，ID:",i),!i){console.error("商品ID为空"),p("商品ID无效");return}const t=await ss(i);console.log("商品详情API响应:",t),t.code===200&&t.data?(a.value={...t.data,images:t.data.images||[],specifications:t.data.specifications||[],params:t.data.params||{},ratingDistribution:t.data.ratingDistribution||[],reviews:t.data.reviews||[],faqs:t.data.faqs||[],promotions:t.data.promotions||[]},console.log("商品详情加载成功:",a.value),a.value.specifications&&a.value.specifications.length>0&&(k.value=a.value.specifications[0].id)):(console.error("商品详情加载失败:",t),p("商品信息加载失败："+(t.message||"未知错误")))}catch(i){console.error("加载商品详情失败:",i),p("加载商品信息失败："+i.message)}},N=async()=>{try{const i=await ts(C.params.id);i.code===200&&(q.value=i.data)}catch(i){console.error("加载推荐商品失败:",i)}};return O(()=>C.params.id,i=>{i&&(window.scrollTo({top:0,behavior:"smooth"}),M(),N(),P.value=0,c.value=1,v.value="description")}),U(()=>{window.scrollTo({top:0,behavior:"smooth"}),M(),N()}),(i,t)=>(n(),l("div",es,[s("nav",as,[s("div",is,[s("ul",os,[t[3]||(t[3]=s("li",null,[s("a",{href:"/"},"首页")],-1)),s("li",null,o(a.value.name),1)])])]),s("div",ls,[s("div",ns,[s("div",cs,[s("div",rs,[s("img",{src:D.value,alt:a.value.name,class:"main-image"},null,8,ds)])]),s("div",us,[s("h1",vs,o(a.value.name),1),s("p",_s,o(a.value.subtitle),1),s("div",ps,[s("div",ms,[s("div",hs,[(n(),l(r,null,d(5,e=>s("i",{key:e,class:f(T(e,a.value.rating))},null,2)),64))]),s("span",fs,o(a.value.rating),1),s("span",gs,"("+o(a.value.reviewCount)+"条评价)",1)]),s("div",bs,"月销 "+o(a.value.monthlySales)+"+ 件",1)]),s("div",ys,[s("div",ks,[t[4]||(t[4]=s("span",{class:"currency"},"¥",-1)),h(o(b.value.price)+" ",1),s("span",ws,"¥"+o(b.value.originalPrice),1)])]),a.value.specifications&&a.value.specifications.length?(n(),l("div",Cs,[t[5]||(t[5]=s("div",{class:"spec-title"},"规格选择：",-1)),s("div",xs,[(n(!0),l(r,null,d(a.value.specifications,e=>(n(),l("div",{key:e.id,class:f(["spec-option",{active:k.value===e.id}]),onClick:_=>z(e.id)},[h(o(e.name)+" ",1),e.tag?(n(),l("span",{key:0,style:$({color:e.tagColor,fontSize:"12px"})}," ("+o(e.tag)+") ",5)):m("",!0)],10,qs))),128))])])):m("",!0),s("div",Is,[t[7]||(t[7]=s("div",{class:"spec-title"},"购买数量：",-1)),s("div",Ps,[s("button",{class:"quantity-btn minus",onClick:H},"-"),y(s("input",{type:"number",class:"quantity-input","onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),min:"1",max:a.value.stock},null,8,Ss),[[G,c.value,void 0,{number:!0}]]),s("button",{class:"quantity-btn plus",onClick:L},"+")]),s("div",Ds,[t[6]||(t[6]=s("i",{class:"fas fa-box"},null,-1)),s("span",{class:f({"in-stock":a.value.stock>0})},o(a.value.stock>0?`库存充足 (还剩 ${a.value.stock} 件)`:"暂时缺货"),3),a.value.maxPurchase?(n(),l("span",Ts," | 限购 "+o(a.value.maxPurchase)+" 件",1)):m("",!0)])]),s("div",Ms,[s("button",{class:"btn btn-primary",onClick:E,disabled:a.value.stock===0},[...t[8]||(t[8]=[s("i",{class:"fas fa-cart-plus"},null,-1),h(" 加入购物车 ",-1)])],8,Ns),s("button",{class:"btn btn-secondary",onClick:F,disabled:a.value.stock===0},[...t[9]||(t[9]=[s("i",{class:"fas fa-bolt"},null,-1),h(" 立即购买 ",-1)])],8,$s)]),s("div",Vs,[(n(),l(r,null,d(B,e=>s("div",{key:e.icon,class:"service-item"},[s("div",Bs,[s("i",{class:f(e.icon)},null,2)]),s("div",Rs,o(e.text),1)])),64))])])]),s("div",zs,[s("div",Hs,[(n(),l(r,null,d(R,e=>s("div",{key:e.id,class:f(["tab-header",{active:v.value===e.id}]),onClick:_=>v.value=e.id},o(e.label),11,Ls)),64))]),s("div",Es,[y(s("div",Fs,[s("div",{class:"product-description",innerHTML:a.value.description},null,8,Js)],512),[[w,v.value==="description"]]),y(s("div",Qs,[s("table",As,[(n(!0),l(r,null,d(a.value.params,(e,_)=>(n(),l("tr",{key:_},[s("td",null,o(_),1),s("td",null,o(e),1)]))),128))])],512),[[w,v.value==="specifications"]]),y(s("div",Os,[s("div",Us,[s("div",js,[s("div",Gs,o(a.value.rating),1),s("div",Ks,[(n(),l(r,null,d(5,e=>s("i",{key:e,class:f(T(e,a.value.rating))},null,2)),64))]),s("div",null,o(a.value.reviewCount)+"条评价",1)]),s("div",Ws,[(n(!0),l(r,null,d(a.value.ratingDistribution,e=>(n(),l("div",{key:e.star,class:"rating-bar"},[s("div",Xs,o(e.star)+"星 ("+o(e.percentage)+"%)",1),s("div",Ys,[s("div",{class:"rating-progress-fill",style:$({width:e.percentage+"%"})},null,4)]),s("div",Zs,o(e.percentage)+"%",1)]))),128))])]),s("div",st,[(n(!0),l(r,null,d(a.value.reviews,e=>(n(),l("div",{key:e.id,class:"review-item"},[s("div",tt,[s("div",et,o(e.userName),1),s("div",at,o(e.date),1)]),s("div",it,[(n(!0),l(r,null,d(e.rating,_=>(n(),l("i",{key:_,class:"fas fa-star"}))),128))]),s("div",ot,o(e.content),1)]))),128))])],512),[[w,v.value==="reviews"]]),y(s("div",lt,[t[12]||(t[12]=s("h3",null,"常见问题",-1)),s("ul",nt,[(n(!0),l(r,null,d(a.value.faqs,e=>(n(),l("li",{key:e.question},[t[11]||(t[11]=s("i",{class:"fas fa-question-circle",style:{color:"var(--primary-color)"}},null,-1)),s("div",null,[s("strong",null,"问："+o(e.question),1),t[10]||(t[10]=s("br",null,null,-1)),h(" 答："+o(e.answer),1)])]))),128))])],512),[[w,v.value==="qa"]])])]),q.value.length?(n(),l("div",ct,[t[13]||(t[13]=s("h2",{class:"section-title"},"推荐商品",-1)),s("div",rt,[(n(!0),l(r,null,d(q.value,e=>(n(),l("div",{key:e.id,class:"product-card-small",onClick:_=>J(e.id)},[s("img",{src:e.image,alt:e.name},null,8,ut),s("div",vt,[s("div",_t,o(e.name),1),s("div",pt,"¥"+o(e.price),1)])],8,dt))),128))])])):m("",!0)]),S.value?(n(),l("div",{key:0,class:"modal",onClick:t[2]||(t[2]=e=>S.value=!1)},[t[14]||(t[14]=s("span",{class:"modal-close"},"×",-1)),s("div",{class:"modal-content",onClick:t[1]||(t[1]=K(()=>{},["stop"]))},[s("img",{src:D.value,alt:"",class:"modal-img"},null,8,mt)])])):m("",!0),j(X,{name:"notification"},{default:W(()=>[g.value.show?(n(),l("div",ht,[t[15]||(t[15]=s("i",{class:"fas fa-check-circle"},null,-1)),h(" "+o(g.value.message),1)])):m("",!0)]),_:1})]))}},kt=Q(ft,[["__scopeId","data-v-368f2683"]]);export{kt as default};
