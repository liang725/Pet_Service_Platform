import{_ as q,u as H,r as u,c as U,o as z,d as o,e as s,h as d,f as G,l as c,E as L,g as Y,t as i,n as f,F as S,s as I,G as J,i as K,v as Q,m as W,b as X,p as n}from"./index-D7KbY98F.js";const Z={class:"appointment-detail"},ss={class:"back-nav"},es={key:0,class:"loading-state"},ts={key:1,class:"error-state"},as={key:2,class:"detail-content"},is={class:"detail-header"},ls={class:"header-main"},os={class:"order-title"},ns={class:"order-no"},cs={key:0,class:"header-actions"},ds={class:"detail-body"},rs={class:"detail-left"},vs={class:"info-card"},us={class:"card-body"},fs={class:"info-grid"},ps={class:"info-item"},ms={class:"info-value"},_s={class:"info-item"},hs={class:"info-value"},ys={class:"info-item"},gs={class:"info-value"},bs={class:"info-item"},ks={class:"info-value price"},Ds={class:"info-item"},ws={class:"info-value"},Ns={class:"info-card"},Ts={class:"card-body"},Ss={class:"pet-profile"},Is={class:"pet-avatar"},As={class:"pet-details"},Cs={class:"pet-meta"},$s={class:"pet-type"},xs={key:0,class:"pet-breed"},Ps={key:0,class:"pet-personality"},Ms={class:"info-card service-info-card"},Fs={class:"card-body"},Rs={key:0,class:"service-section"},Bs={class:"service-list"},Vs={class:"service-item-main"},Es={class:"service-item-name"},Os={class:"service-item-price"},js={class:"service-item-details"},qs={class:"service-item-desc"},Hs={key:0,class:"service-item-discount"},Us={key:1,class:"service-section"},zs={class:"care-list"},Gs={class:"care-item-main"},Ls={class:"care-item-name"},Ys={class:"care-item-price"},Js={class:"care-item-details"},Ks={class:"care-category"},Qs={class:"care-item-desc"},Ws={key:2,class:"no-service"},Xs={key:3,class:"price-summary"},Zs={key:0,class:"price-row"},se={class:"price-value"},ee={key:1,class:"price-row"},te={class:"price-value discount"},ae={key:2,class:"price-row"},ie={class:"price-value"},le={class:"price-row total-price"},oe={class:"price-value"},ne={class:"detail-right"},ce={key:0,class:"info-card special-notes-card"},de={class:"card-body"},re={class:"notes-content"},ve={class:"info-card timeline-card"},ue={class:"card-body"},fe={class:"timeline"},pe={class:f(["timeline-item",{active:!0}])},me={class:"timeline-content"},_e={class:"timeline-time"},he={class:"timeline-content"},ye={key:0,class:"timeline-time"},ge={key:1,class:"timeline-time"},be={class:"timeline-content"},ke={key:0,class:"timeline-time"},De={key:1,class:"timeline-time"},we={class:"detail-footer"},Ne={class:"footer-actions"},Te={key:3,class:"modal-overlay"},Se={class:"modal-content"},Ie={class:"modal-body"},Ae={class:"cancel-details"},Ce={class:"cancel-reason"},$e={class:"char-count"},xe={class:"modal-footer"},Pe={__name:"ServiceAppointmentDetailView",props:{id:{type:[String,Number],required:!0}},setup(A){X();const k=W(),D=H(),_=A,h=u(!0),p=u(null),t=u(null),m=u(!1),v=u(""),C=U(()=>{if(!t.value)return 60;let a=0;return t.value.services&&t.value.services.length>0&&t.value.services.forEach(e=>{a+=e.duration||60}),t.value.careItems&&t.value.careItems.length>0&&(a+=t.value.careItems.length*15),a||60});function $(a){return{pending:"待服务",confirmed:"已确认",completed:"已完成",cancelled:"已取消"}[a]||a}function x(a){return a==="狗"?"fas fa-dog":"fas fa-cat"}function P(a){return{局部护理:"局部护理",深度护理:"深度护理",精致修剪:"精致修剪",赠送护理:"赠送护理"}[a]||a}function M(){if(!t.value)return"";const a=[];return t.value.services&&t.value.services.length>0&&t.value.services.forEach(e=>{a.push(e.itemName||e.serviceName)}),t.value.careItems&&t.value.careItems.length>0&&t.value.careItems.forEach(e=>{a.push(e.careName)}),a.join("、")}function y(a){if(!a)return"";const e=new Date(a),r=e.getFullYear(),l=e.getMonth()+1,b=e.getDate(),j=["日","一","二","三","四","五","六"][e.getDay()];return`${r}年${l}月${b}日 (周${j})`}function w(a){if(!a)return"";const e=new Date(a),r=e.getMonth()+1,l=e.getDate(),b=e.getHours().toString().padStart(2,"0"),T=e.getMinutes().toString().padStart(2,"0");return`${r}月${l}日 ${b}:${T}`}function N(a){const e=new Date,r=e.getHours().toString().padStart(2,"0"),l=e.getMinutes().toString().padStart(2,"0");return`${r}:${l}`}async function g(){h.value=!0,p.value=null;try{console.log("开始获取预约详情，ID:",_.id);const a=await D.getAppointmentDetail(_.id);console.log("预约详情原始数据:",a);let e=a;a&&typeof a=="object"&&a.data&&(e=a.data),t.value={id:parseInt(e.id)||_.id,orderNo:e.orderNo||`ORD-${new Date().getTime()}`,petName:e.petName||e.pet?.name||"未命名",petType:e.petType||e.pet?.type||"未知",breed:e.breed||e.pet?.breed||"",personality:e.personality||e.pet?.personality||"",appointmentDate:e.appointmentDate||new Date().toISOString().split("T")[0],timeSlot:e.timeSlot||"09:00",orderTotalAmount:parseFloat(e.orderTotalAmount)||parseFloat(e.totalAmount)||0,itemsBaseTotal:parseFloat(e.itemsBaseTotal)||0,itemsDiscountTotal:parseFloat(e.itemsDiscountTotal)||0,careItemsTotal:parseFloat(e.careItemsTotal)||0,specialNotes:e.specialNotes||"",status:e.status||"pending",createdAt:e.createdAt||new Date().toISOString(),updatedAt:e.updatedAt||new Date().toISOString(),cancellationReason:e.cancellationReason||"",services:e.services||[],careItems:e.careItems||[]},(!t.value.services||t.value.services.length===0)&&e.serviceName&&(t.value.services=[{serviceId:0,serviceName:e.serviceName,category:e.serviceCategory||"洗护服务",description:e.serviceDescription||"",basePrice:t.value.orderTotalAmount,discountPercentage:0,discountAmount:0,finalPrice:t.value.orderTotalAmount,duration:60,quantity:1}]),console.log("格式化后详情数据:",t.value)}catch(a){console.error("获取预约详情失败:",a),p.value=a.message||"加载预约详情失败"}finally{h.value=!1}}function F(){k.back()}function R(){v.value="",m.value=!0}async function B(){if(t.value)try{await D.cancelAppointment(t.value.id,v.value||"用户主动取消"),m.value=!1,alert("预约已取消"),await g()}catch(a){console.error("取消预约失败:",a),alert(a.message||"取消预约失败")}}function V(){k.push(`/service/review/${t.value.id}`)}function E(){window.print()}function O(){navigator.share?navigator.share({title:`宠物之家预约 - ${t.value.orderNo}`,text:`我在宠物之家预约了服务，时间：${y(t.value.appointmentDate)} ${t.value.timeSlot}`,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),alert("链接已复制到剪贴板"))}return z(()=>{g()}),(a,e)=>{const r=Y("router-link");return n(),o("div",Z,[s("div",ss,[s("button",{class:"btn-back",onClick:F},[...e[2]||(e[2]=[s("i",{class:"fas fa-arrow-left"},null,-1),c(" 返回 ",-1)])]),G(r,{to:"/service/orders",class:"btn-all-orders"},{default:L(()=>[...e[3]||(e[3]=[s("i",{class:"fas fa-list"},null,-1),c(" 所有预约 ",-1)])]),_:1})]),h.value?(n(),o("div",es,[...e[4]||(e[4]=[s("div",{class:"spinner"},[s("i",{class:"fas fa-spinner fa-spin"})],-1),s("p",null,"加载预约详情中...",-1)])])):p.value?(n(),o("div",ts,[e[6]||(e[6]=s("div",{class:"error-icon"},[s("i",{class:"fas fa-exclamation-circle"})],-1)),e[7]||(e[7]=s("h3",null,"加载失败",-1)),s("p",null,i(p.value),1),s("button",{class:"btn-retry",onClick:g},[...e[5]||(e[5]=[s("i",{class:"fas fa-redo"},null,-1),c(" 重试 ",-1)])])])):t.value?(n(),o("div",as,[s("div",is,[s("div",ls,[s("div",os,[e[8]||(e[8]=s("h1",null,"预约详情",-1)),s("div",{class:f(["status-badge",t.value.status])},i($(t.value.status)),3)]),s("div",ns,[e[9]||(e[9]=s("i",{class:"fas fa-receipt"},null,-1)),c(" 订单号："+i(t.value.orderNo),1)])]),t.value.status==="pending"?(n(),o("div",cs,[s("button",{class:"btn-action cancel",onClick:R},[...e[10]||(e[10]=[s("i",{class:"fas fa-times"},null,-1),c(" 取消预约 ",-1)])])])):d("",!0)]),s("div",ds,[s("div",rs,[s("div",vs,[e[16]||(e[16]=s("div",{class:"card-header"},[s("i",{class:"fas fa-info-circle"}),s("h3",null,"预约信息")],-1)),s("div",us,[s("div",fs,[s("div",ps,[e[11]||(e[11]=s("div",{class:"info-label"},[s("i",{class:"far fa-calendar"}),c(" 预约日期 ")],-1)),s("div",ms,i(y(t.value.appointmentDate)),1)]),s("div",_s,[e[12]||(e[12]=s("div",{class:"info-label"},[s("i",{class:"far fa-clock"}),c(" 预约时间 ")],-1)),s("div",hs,i(t.value.timeSlot),1)]),s("div",ys,[e[13]||(e[13]=s("div",{class:"info-label"},[s("i",{class:"fas fa-clock"}),c(" 预计时长 ")],-1)),s("div",gs,i(C.value)+"分钟 ",1)]),s("div",bs,[e[14]||(e[14]=s("div",{class:"info-label"},[s("i",{class:"fas fa-yen-sign"}),c(" 预约金额 ")],-1)),s("div",ks," ¥"+i(t.value.orderTotalAmount),1)]),s("div",Ds,[e[15]||(e[15]=s("div",{class:"info-label"},[s("i",{class:"far fa-calendar-check"}),c(" 创建时间 ")],-1)),s("div",ws,i(w(t.value.createdAt)),1)])])])]),s("div",Ns,[e[18]||(e[18]=s("div",{class:"card-header"},[s("i",{class:"fas fa-paw"}),s("h3",null,"宠物信息")],-1)),s("div",Ts,[s("div",Ss,[s("div",Is,[s("i",{class:f(x(t.value.petType))},null,2)]),s("div",As,[s("h4",null,i(t.value.petName),1),s("div",Cs,[s("span",$s,i(t.value.petType),1),t.value.breed?(n(),o("span",xs,i(t.value.breed),1)):d("",!0)]),t.value.personality?(n(),o("p",Ps,[e[17]||(e[17]=s("i",{class:"fas fa-heart"},null,-1)),c(" "+i(t.value.personality),1)])):d("",!0)])])])]),s("div",Ms,[e[26]||(e[26]=s("div",{class:"card-header"},[s("i",{class:"fas fa-spa"}),s("h3",null,"服务信息")],-1)),s("div",Fs,[t.value.services&&t.value.services.length>0?(n(),o("div",Rs,[e[19]||(e[19]=s("h4",{class:"section-title"},[s("i",{class:"fas fa-shower"}),c(" 洗护项目 ")],-1)),s("div",Bs,[(n(!0),o(S,null,I(t.value.services,l=>(n(),o("div",{key:l.id||l.serviceId,class:"service-item"},[s("div",Vs,[s("div",Es,i(l.itemName||l.serviceName),1),s("div",Os,"¥"+i(l.itemFinalPrice||l.finalPrice||l.basePrice),1)]),s("div",js,[s("div",qs,i(l.briefDesc||l.description),1),l.itemDiscountPercentage>0||l.discountPercentage>0?(n(),o("div",Hs," 折扣: "+i(l.itemDiscountPercentage||l.discountPercentage)+"% ",1)):d("",!0)])]))),128))])])):d("",!0),t.value.careItems&&t.value.careItems.length>0?(n(),o("div",Us,[e[20]||(e[20]=s("h4",{class:"section-title"},[s("i",{class:"fas fa-heartbeat"}),c(" 护理项目 ")],-1)),s("div",zs,[(n(!0),o(S,null,I(t.value.careItems,l=>(n(),o("div",{key:l.id||l.careId,class:"care-item"},[s("div",Gs,[s("div",Ls,i(l.careName),1),s("div",Ys,"¥"+i(l.unitPrice),1)]),s("div",Js,[s("span",Ks,i(P(l.careCategory)),1),s("div",Qs,i(l.description),1)])]))),128))])])):d("",!0),(!t.value.services||t.value.services.length===0)&&(!t.value.careItems||t.value.careItems.length===0)?(n(),o("div",Ws,[...e[21]||(e[21]=[s("i",{class:"fas fa-info-circle"},null,-1),s("p",null,"暂无服务信息",-1)])])):d("",!0),t.value.services||t.value.careItems?(n(),o("div",Xs,[t.value.itemsBaseTotal>0?(n(),o("div",Zs,[e[22]||(e[22]=s("span",{class:"price-label"},"洗护项目总价:",-1)),s("span",se,"¥"+i(t.value.itemsBaseTotal),1)])):d("",!0),t.value.itemsDiscountTotal>0?(n(),o("div",ee,[e[23]||(e[23]=s("span",{class:"price-label"},"洗护折扣:",-1)),s("span",te,"-¥"+i(t.value.itemsDiscountTotal),1)])):d("",!0),t.value.careItemsTotal>0?(n(),o("div",ae,[e[24]||(e[24]=s("span",{class:"price-label"},"护理项目总价:",-1)),s("span",ie,"¥"+i(t.value.careItemsTotal),1)])):d("",!0),s("div",le,[e[25]||(e[25]=s("span",{class:"price-label"},"订单总金额:",-1)),s("span",oe,"¥"+i(t.value.orderTotalAmount),1)])])):d("",!0)])])]),s("div",ne,[t.value.specialNotes?(n(),o("div",ce,[e[27]||(e[27]=s("div",{class:"card-header"},[s("i",{class:"fas fa-sticky-note"}),s("h3",null,"特殊要求")],-1)),s("div",de,[s("div",re,i(t.value.specialNotes),1)])])):d("",!0),e[35]||(e[35]=J('<div class="info-card instructions-card" data-v-47161c02><div class="card-header" data-v-47161c02><i class="fas fa-list-ol" data-v-47161c02></i><h3 data-v-47161c02>预约须知</h3></div><div class="card-body" data-v-47161c02><ul class="instructions-list" data-v-47161c02><li data-v-47161c02><i class="fas fa-check-circle" data-v-47161c02></i> 请提前15分钟到达门店，以便准备工作 </li><li data-v-47161c02><i class="fas fa-check-circle" data-v-47161c02></i> 请携带宠物免疫证明（如有） </li><li data-v-47161c02><i class="fas fa-check-circle" data-v-47161c02></i> 预约前2小时可免费取消或改期 </li><li data-v-47161c02><i class="fas fa-check-circle" data-v-47161c02></i> 如有特殊情况无法按时到达，请及时联系我们 </li><li data-v-47161c02><i class="fas fa-check-circle" data-v-47161c02></i> 服务完成后请及时评价，帮助我们改进服务 </li></ul></div></div><div class="info-card store-card" data-v-47161c02><div class="card-header" data-v-47161c02><i class="fas fa-store" data-v-47161c02></i><h3 data-v-47161c02>服务门店</h3></div><div class="card-body" data-v-47161c02><div class="store-info" data-v-47161c02><h4 data-v-47161c02>宠物之家旗舰店</h4><div class="store-details" data-v-47161c02><p data-v-47161c02><i class="fas fa-map-marker-alt" data-v-47161c02></i> 北京市朝阳区宠物之家大厦</p><p data-v-47161c02><i class="fas fa-phone" data-v-47161c02></i> 400-123-4567</p><p data-v-47161c02><i class="far fa-clock" data-v-47161c02></i> 营业时间：09:00 - 20:00</p></div><div class="store-actions" data-v-47161c02><button class="btn-store contact" data-v-47161c02><i class="fas fa-phone" data-v-47161c02></i> 联系门店 </button><button class="btn-store navigate" data-v-47161c02><i class="fas fa-map-marked-alt" data-v-47161c02></i> 导航前往 </button></div></div></div></div>',2)),s("div",ve,[e[34]||(e[34]=s("div",{class:"card-header"},[s("i",{class:"fas fa-history"}),s("h3",null,"状态时间线")],-1)),s("div",ue,[s("div",fe,[s("div",pe,[e[29]||(e[29]=s("div",{class:"timeline-icon"},[s("i",{class:"fas fa-calendar-plus"})],-1)),s("div",me,[e[28]||(e[28]=s("div",{class:"timeline-title"},"预约创建",-1)),s("div",_e,i(w(t.value.createdAt)),1)])]),s("div",{class:f(["timeline-item",{active:t.value.status!=="pending"}])},[e[31]||(e[31]=s("div",{class:"timeline-icon"},[s("i",{class:"fas fa-check-circle"})],-1)),s("div",he,[e[30]||(e[30]=s("div",{class:"timeline-title"},"预约确认",-1)),t.value.status!=="pending"?(n(),o("div",ye,i(N()),1)):(n(),o("div",ge,"待确认"))])],2),s("div",{class:f(["timeline-item",{active:t.value.status==="completed"}])},[e[33]||(e[33]=s("div",{class:"timeline-icon"},[s("i",{class:"fas fa-check-double"})],-1)),s("div",be,[e[32]||(e[32]=s("div",{class:"timeline-title"},"服务完成",-1)),t.value.status==="completed"?(n(),o("div",ke,i(N()),1)):(n(),o("div",De,"待完成"))])],2)])])])])]),s("div",we,[e[39]||(e[39]=s("div",{class:"footer-info"},[s("p",null,"如有任何问题，请联系客服：400-123-4567")],-1)),s("div",Ne,[s("button",{class:"btn-secondary",onClick:E},[...e[36]||(e[36]=[s("i",{class:"fas fa-print"},null,-1),c(" 打印预约单 ",-1)])]),s("button",{class:"btn-secondary",onClick:O},[...e[37]||(e[37]=[s("i",{class:"fas fa-share-alt"},null,-1),c(" 分享 ",-1)])]),t.value.status==="completed"?(n(),o("button",{key:0,class:"btn-primary",onClick:V},[...e[38]||(e[38]=[s("i",{class:"fas fa-star"},null,-1),c(" 评价服务 ",-1)])])):d("",!0)])])])):d("",!0),m.value?(n(),o("div",Te,[s("div",Se,[e[46]||(e[46]=s("div",{class:"modal-header"},[s("i",{class:"fas fa-exclamation-triangle warning-icon"}),s("h3",null,"确认取消预约")],-1)),s("div",Ie,[s("p",null,[e[40]||(e[40]=c("确定要取消预约 ",-1)),s("strong",null,i(t.value?.orderNo),1),e[41]||(e[41]=c(" 吗？",-1))]),s("div",Ae,[s("p",null,[e[42]||(e[42]=s("i",{class:"fas fa-paw"},null,-1)),c(" 宠物："+i(t.value?.petName),1)]),s("p",null,[e[43]||(e[43]=s("i",{class:"fas fa-spa"},null,-1)),c(" 服务："+i(M()),1)]),s("p",null,[e[44]||(e[44]=s("i",{class:"far fa-calendar"},null,-1)),c(" 时间："+i(y(t.value?.appointmentDate))+" "+i(t.value?.timeSlot),1)])]),s("div",Ce,[e[45]||(e[45]=s("label",{for:"cancelReasonDetail"},[s("i",{class:"fas fa-comment-dots"}),c(" 取消原因（可选）： ")],-1)),K(s("textarea",{id:"cancelReasonDetail","onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),placeholder:"请告诉我们取消的原因...",rows:"3",maxlength:"200"},null,512),[[Q,v.value]]),s("div",$e,i(v.value?.length||0)+"/200",1)])]),s("div",xe,[s("button",{class:"btn-secondary",onClick:e[1]||(e[1]=l=>m.value=!1)}," 再考虑一下 "),s("button",{class:"btn-danger",onClick:B}," 确认取消 ")])])])):d("",!0)])}}},Fe=q(Pe,[["__scopeId","data-v-47161c02"]]);export{Fe as default};
