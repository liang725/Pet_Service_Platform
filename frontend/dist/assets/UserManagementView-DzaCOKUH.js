import{_ as J,r as u,c as Q,o as W,y as k,d as r,e,h as f,f as d,i as y,q as n,K as i,v as D,I as X,l as m,F as Y,s as Z,D as M,t as c,w as x,k as q,p as o,n as L}from"./index-D7KbY98F.js";const ee={class:"user-management"},se={class:"toolbar"},le={class:"search-box"},te={key:0,class:"loading-state"},ae={key:1,class:"empty-state"},oe={key:2,class:"table-container"},ne={class:"user-table"},ie={class:"user-info"},re={class:"action-buttons"},ue=["onClick"],de=["onClick"],ce=["onClick","title"],ve=["onClick"],pe={key:3,class:"pagination"},me={class:"page-size-selector"},ge={class:"page-controls"},fe=["disabled"],be={class:"page-info"},we=["disabled"],ye={class:"dialog-header"},ke={class:"form-group"},he={class:"form-group"},Ce=["required","placeholder"],_e={key:0,class:"hint"},Ue={key:0,class:"form-group"},Pe=["required"],$e={class:"form-group"},De={class:"form-group"},qe={class:"dialog-actions"},Ve=["disabled"],Se={class:"dialog-header"},Te={class:"dialog-body"},Ee={class:"reset-password-confirm"},Me={class:"dialog-actions"},xe=["disabled"],ze={__name:"UserManagementView",setup(Ie){const V=u([]),S=u(!1),g=u(1),h=u(10),C=u(0),_=u(""),U=u(!1),v=u(!1),p=u(!1),T=u(!1),E=u(null),a=u({username:"",password:"",role:"user",status:1}),z=Q(()=>Math.ceil(C.value/h.value));W(()=>{b()});async function b(){S.value=!0;try{const t={page:g.value,pageSize:h.value};_.value&&(t.keyword=_.value);const s=await k({url:"/api/admin/users",method:"GET",params:t});s.code===200&&(V.value=s.data.list||[],C.value=s.data.total||0)}catch(t){console.error("加载用户失败:",t),alert("加载用户失败")}finally{S.value=!1}}function I(){g.value=1,b()}function N(t){g.value=t,b()}function B(){g.value=1,b()}function K(){v.value=!1,a.value={username:"",password:"",confirmPassword:"",role:"user",status:1},U.value=!0}function R(t){v.value=!0,a.value={id:t.id,username:t.username,role:t.role,status:t.status},U.value=!0}function P(){U.value=!1}async function F(){if(!a.value.username||a.value.username.trim().length===0){alert("用户名不能为空");return}let t=null;if(v.value){if(a.value.password&&a.value.password.trim().length>0){if(a.value.password.length<6){alert("密码长度不能少于6位");return}if(a.value.password!==a.value.confirmPassword){alert("两次输入的密码不一致");return}t=a.value.password}}else{if(!a.value.password||a.value.password.trim().length===0){alert("密码不能为空");return}if(a.value.password.length<6){alert("密码长度不能少于6位");return}if(a.value.password!==a.value.confirmPassword){alert("两次输入的密码不一致");return}t=a.value.password}p.value=!0;try{const s={username:a.value.username.trim(),role:a.value.role,status:Number(a.value.status)};if(t)s.password=t;else if(!v.value)throw new Error("添加用户必须设置密码");console.log("提交的用户数据:",s);let l;v.value?l=await k({url:`/api/admin/users/${a.value.id}`,method:"PUT",data:s}):l=await k({url:"/api/admin/users",method:"POST",data:s}),console.log("API响应:",l),l.code===200?(alert(v.value?"更新成功":"添加成功"),P(),b()):alert(l.message||"操作失败")}catch(s){console.error("保存失败:",s),alert("保存失败: "+(s.response?.data?.message||s.message))}finally{p.value=!1}}function G(t){E.value=t.id,T.value=!0}function $(){T.value=!1,E.value=null}async function O(){p.value=!0;try{const t=await k({url:`/api/admin/users/${E.value}/reset-password`,method:"PUT",data:{password:"123456"}});t.code===200?(alert("密码已重置为：123456"),$(),b()):alert(t.message||"密码重置失败")}catch(t){console.error("密码重置失败:",t),alert("密码重置失败: "+(t.response?.data?.message||t.message))}finally{p.value=!1}}async function j(t){const s=t.status===1?0:1,l=s===1?"启用":"禁用";if(confirm(`确定要${l}用户"${t.username}"吗？`))try{const w=await k({url:`/api/admin/users/${t.id}/status`,method:"PUT",data:{status:s}});w.code===200?(alert(`${l}成功`),b()):alert(w.message||`${l}失败`)}catch(w){console.error(`${l}失败:`,w),alert(`${l}失败`)}}async function H(t){if(confirm(`确定要删除用户"${t.username}"吗？此操作不可恢复！`))try{const s=await k({url:`/api/admin/users/${t.id}`,method:"DELETE"});s.code===200?(alert("删除成功"),b()):alert(s.message||"删除失败")}catch(s){console.error("删除失败:",s),alert("删除失败")}}function A(t){return t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}return(t,s)=>(o(),r("div",ee,[s[29]||(s[29]=e("div",{class:"page-header"},[e("h1",null,"用户管理"),e("p",null,"管理系统用户信息和权限")],-1)),e("div",se,[e("div",le,[d(n(i),{icon:"mdi:magnify",class:"search-icon"}),y(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>_.value=l),placeholder:"搜索用户名...",onKeyup:X(I,["enter"])},null,544),[[D,_.value]]),e("button",{class:"search-btn",onClick:I},"搜索")]),e("button",{class:"add-btn",onClick:K},[d(n(i),{icon:"mdi:plus"}),s[11]||(s[11]=m(" 添加用户 ",-1))])]),S.value?(o(),r("div",te,[d(n(i),{icon:"mdi:loading",class:"spin"}),s[12]||(s[12]=e("span",null,"加载中...",-1))])):V.value.length===0?(o(),r("div",ae,[d(n(i),{icon:"mdi:account-group",class:"empty-icon"}),s[13]||(s[13]=e("h3",null,"暂无用户",-1)),s[14]||(s[14]=e("p",null,"点击上方按钮添加第一个用户",-1))])):(o(),r("div",oe,[e("table",ne,[s[15]||(s[15]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"用户名"),e("th",null,"角色"),e("th",null,"状态"),e("th",null,"注册时间"),e("th",null,"最后登录"),e("th",null,"操作")])],-1)),e("tbody",null,[(o(!0),r(Y,null,Z(V.value,l=>(o(),r("tr",{key:l.id},[e("td",null,c(l.id),1),e("td",null,[e("div",ie,[d(n(i),{icon:"mdi:account-circle",class:"user-icon"}),e("span",null,c(l.username),1)])]),e("td",null,[e("span",{class:L(["role-badge",l.role])},[l.role==="admin"?(o(),q(n(i),{key:0,icon:"mdi:shield-crown"})):(o(),q(n(i),{key:1,icon:"mdi:account"})),m(" "+c(l.role==="admin"?"管理员":"普通用户"),1)],2)]),e("td",null,[e("span",{class:L(["status-badge",{active:l.status===1}])},c(l.status===1?"正常":"禁用"),3)]),e("td",null,c(A(l.createdAt)),1),e("td",null,c(l.lastLoginAt?A(l.lastLoginAt):"未登录"),1),e("td",null,[e("div",re,[e("button",{class:"action-btn edit",onClick:w=>R(l),title:"编辑"},[d(n(i),{icon:"mdi:pencil"})],8,ue),e("button",{class:"action-btn password",onClick:w=>G(l),title:"重置密码"},[d(n(i),{icon:"mdi:lock-reset"})],8,de),l.role!=="admin"?(o(),r("button",{key:0,class:"action-btn toggle",onClick:w=>j(l),title:l.status===1?"禁用":"启用"},[d(n(i),{icon:l.status===1?"mdi:account-off":"mdi:account-check"},null,8,["icon"])],8,ce)):f("",!0),l.role!=="admin"?(o(),r("button",{key:1,class:"action-btn delete",onClick:w=>H(l),title:"删除"},[d(n(i),{icon:"mdi:delete"})],8,ve)):f("",!0)])])]))),128))])])])),C.value>0?(o(),r("div",pe,[e("div",me,[s[17]||(s[17]=e("span",null,"每页显示",-1)),y(e("select",{"onUpdate:modelValue":s[1]||(s[1]=l=>h.value=l),onChange:B},[...s[16]||(s[16]=[e("option",{value:5},"5 条",-1),e("option",{value:10},"10 条",-1),e("option",{value:20},"20 条",-1),e("option",{value:50},"50 条",-1),e("option",{value:100},"100 条",-1)])],544),[[M,h.value,void 0,{number:!0}]])]),e("div",ge,[e("button",{disabled:g.value===1,onClick:s[2]||(s[2]=l=>N(g.value-1))},"上一页",8,fe),e("span",be,"第 "+c(g.value)+" / "+c(z.value)+" 页，共 "+c(C.value)+" 条",1),e("button",{disabled:g.value>=z.value,onClick:s[3]||(s[3]=l=>N(g.value+1))},"下一页",8,we)])])):f("",!0),U.value?(o(),r("div",{key:4,class:"dialog-overlay",onClick:P},[e("div",{class:"dialog",onClick:s[9]||(s[9]=x(()=>{},["stop"]))},[e("div",ye,[e("h3",null,c(v.value?"编辑用户":"添加用户"),1),e("button",{class:"close-btn",onClick:P},[d(n(i),{icon:"mdi:close"})])]),e("form",{class:"dialog-body",onSubmit:x(F,["prevent"])},[e("div",ke,[s[18]||(s[18]=e("label",null,[m("用户名 "),e("span",{class:"required"},"*")],-1)),y(e("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>a.value.username=l),required:"",placeholder:"请输入用户名"},null,512),[[D,a.value.username]])]),e("div",he,[s[19]||(s[19]=e("label",null,[m("密码 "),e("span",{class:"required"},"*")],-1)),y(e("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>a.value.password=l),type:"password",required:!v.value,minlength:"6",placeholder:v.value?"留空则不修改密码":"请输入密码（至少6位）"},null,8,Ce),[[D,a.value.password]]),v.value?(o(),r("small",_e,"留空则不修改密码")):f("",!0)]),a.value.password?(o(),r("div",Ue,[s[20]||(s[20]=e("label",null,[m("确认密码 "),e("span",{class:"required"},"*")],-1)),y(e("input",{"onUpdate:modelValue":s[6]||(s[6]=l=>a.value.confirmPassword=l),type:"password",required:!!a.value.password,minlength:"6",placeholder:"请再次输入密码"},null,8,Pe),[[D,a.value.confirmPassword]])])):f("",!0),e("div",$e,[s[22]||(s[22]=e("label",null,[m("角色 "),e("span",{class:"required"},"*")],-1)),y(e("select",{"onUpdate:modelValue":s[7]||(s[7]=l=>a.value.role=l),required:""},[...s[21]||(s[21]=[e("option",{value:"user"},"普通用户",-1),e("option",{value:"admin"},"管理员",-1)])],512),[[M,a.value.role]])]),e("div",De,[s[24]||(s[24]=e("label",null,[m("状态 "),e("span",{class:"required"},"*")],-1)),y(e("select",{"onUpdate:modelValue":s[8]||(s[8]=l=>a.value.status=l),required:""},[...s[23]||(s[23]=[e("option",{value:1},"正常",-1),e("option",{value:0},"禁用",-1)])],512),[[M,a.value.status,void 0,{number:!0}]])]),e("div",qe,[e("button",{type:"button",class:"cancel-btn",onClick:P},"取消"),e("button",{type:"submit",class:"submit-btn",disabled:p.value},[p.value?(o(),q(n(i),{key:0,icon:"mdi:loading",class:"spin"})):f("",!0),m(" "+c(p.value?"保存中...":"保存"),1)],8,Ve)])],32)])])):f("",!0),T.value?(o(),r("div",{key:5,class:"dialog-overlay",onClick:$},[e("div",{class:"dialog small",onClick:s[10]||(s[10]=x(()=>{},["stop"]))},[e("div",Se,[s[25]||(s[25]=e("h3",null,"重置密码",-1)),e("button",{class:"close-btn",onClick:$},[d(n(i),{icon:"mdi:close"})])]),e("div",Te,[e("div",Ee,[d(n(i),{icon:"mdi:alert-circle",class:"warning-icon"}),s[26]||(s[26]=e("p",{class:"confirm-message"},"确定要将该用户的密码重置为默认密码吗？",-1)),s[27]||(s[27]=e("p",{class:"default-password-hint"},[m("默认密码："),e("strong",null,"123456")],-1)),s[28]||(s[28]=e("p",{class:"security-hint"},"建议用户登录后立即修改密码",-1))]),e("div",Me,[e("button",{type:"button",class:"cancel-btn",onClick:$}," 取消 "),e("button",{type:"button",class:"submit-btn",disabled:p.value,onClick:O},[p.value?(o(),q(n(i),{key:0,icon:"mdi:loading",class:"spin"})):f("",!0),m(" "+c(p.value?"重置中...":"确认重置"),1)],8,xe)])])])])):f("",!0)]))}},Ae=J(ze,[["__scopeId","data-v-b54405c8"]]);export{Ae as default};
