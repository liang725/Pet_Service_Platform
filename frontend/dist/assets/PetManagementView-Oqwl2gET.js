import{_ as W,r as c,c as X,o as Z,y as D,d as r,e as l,h as m,f as v,q as d,K as u,t as a,i as p,v as g,I as ll,l as f,F as el,s as tl,D as M,w as $,k as z,p as i,n as K}from"./index-D7KbY98F.js";const sl={class:"pet-management"},al={key:0,class:"stats-cards"},nl={class:"stat-card"},ol={class:"stat-content"},il={class:"stat-card"},dl={class:"stat-content"},ul={class:"stat-card"},rl={class:"stat-content"},vl={class:"stat-card"},cl={class:"stat-content"},pl={class:"toolbar"},ml={class:"search-box"},gl={key:1,class:"loading-state"},bl={key:2,class:"empty-state"},fl={key:3,class:"table-container"},yl={class:"pet-table"},hl={class:"pet-info"},_l={class:"pet-avatar"},wl=["src","alt"],kl={class:"pet-details"},Dl={key:0,class:"pet-color"},Ul={class:"owner-info"},Cl={class:"age-weight"},Il={key:0},Tl={key:1,class:"weight"},Vl={class:"action-buttons"},xl=["onClick"],Pl=["onClick"],Sl=["onClick"],ql={key:4,class:"pagination"},El={class:"page-size-selector"},Ml={class:"page-controls"},$l=["disabled"],zl={class:"page-info"},Fl=["disabled"],Al={class:"dialog-header"},Ll={class:"form-row"},Nl={class:"form-group"},Ol={class:"form-group"},Bl={class:"form-row"},Kl={class:"form-group"},Gl={class:"form-group"},Rl={class:"form-row"},Yl={class:"form-group"},jl=["max"],Hl={class:"form-group"},Jl={class:"form-group"},Ql={class:"form-group"},Wl={class:"form-group"},Xl={class:"form-group"},Zl={class:"form-group"},le={class:"dialog-actions"},ee=["disabled"],te={class:"dialog-header"},se={key:0,class:"detail-body"},ae={class:"pet-header"},ne={class:"detail-avatar"},oe=["src","alt"],ie={class:"detail-title"},de={class:"pet-tags"},ue={class:"type-tag"},re={class:"gender-tag"},ve={key:0,class:"breed-tag"},ce={class:"detail-grid"},pe={class:"detail-item"},me={class:"detail-item"},ge={class:"detail-item"},be={class:"detail-item"},fe={class:"detail-item"},ye={class:"detail-item"},he={class:"detail-item full-width"},_e={class:"detail-item full-width"},we={class:"notes-content"},ke={class:"detail-item"},De={class:"detail-item"},Ue={__name:"PetManagementView",setup(Ce){const U=c([]),P=c(!1),b=c(1),C=c(10),I=c(0),T=c(""),y=c(null),V=c(!1),S=c(!1),_=c(!1),w=c(!1),o=c(null),n=c({name:"",petType:"",breed:"",gender:"",birthDate:"",weight:"",color:"",userId:"",avatarUrl:"",personality:"",notes:""}),F=X(()=>Math.ceil(I.value/C.value));Z(()=>{h(),q()});async function h(){P.value=!0;try{const s={page:b.value,pageSize:C.value};T.value.trim()&&(s.keyword=T.value.trim());const e=await D({url:"/api/admin/pets",method:"GET",params:s});e.code===200?(U.value=e.data.list||[],I.value=e.data.total||0,U.value.forEach(t=>{t.birthDate&&(t.age=O(t.birthDate))})):alert(e.message||"加载宠物列表失败")}catch(s){console.error("加载宠物列表失败:",s),alert("加载宠物列表失败")}finally{P.value=!1}}async function q(){try{const s=await D({url:"/api/admin/pets/stats",method:"GET"});s.code===200&&(y.value=s.data)}catch(s){console.error("加载统计信息失败:",s)}}function A(){b.value=1,h()}function L(s){b.value=s,h()}function G(){b.value=1,h()}function R(){_.value=!1,n.value={name:"",petType:"",breed:"",gender:"",birthDate:"",weight:"",color:"",userId:"",avatarUrl:"",personality:"",notes:""},V.value=!0}function Y(s){_.value=!0,n.value={id:s.id,name:s.name,petType:s.petType,breed:s.breed||"",gender:s.gender,birthDate:s.birthDate?Q(s.birthDate):"",weight:s.weight||"",color:s.color||"",userId:s.userId,avatarUrl:s.avatarUrl||"",personality:s.personality||"",notes:s.notes||""},V.value=!0}function j(s){o.value={...s},S.value=!0}function x(){V.value=!1}function N(){S.value=!1,o.value=null}async function H(){if(!n.value.name.trim()){alert("请输入宠物名称");return}if(!n.value.petType){alert("请选择宠物类型");return}if(!n.value.gender){alert("请选择性别");return}if(!n.value.userId){alert("请输入主人用户ID");return}w.value=!0;try{const s={...n.value,weight:n.value.weight?parseFloat(n.value.weight):null};Object.keys(s).forEach(t=>{(s[t]===""||s[t]===null)&&delete s[t]});let e;_.value?e=await D({url:`/api/admin/pets/${s.id}`,method:"PUT",data:s}):e=await D({url:"/api/admin/pets",method:"POST",data:s}),e.code===200?(alert(_.value?"更新成功":"添加成功"),x(),h(),q()):alert(e.message||"操作失败")}catch(s){console.error("保存失败:",s),alert("保存失败")}finally{w.value=!1}}async function J(s){if(confirm(`确定要删除宠物"${s.name}"吗？此操作不可恢复！`))try{const e=await D({url:`/api/admin/pets/${s.id}`,method:"DELETE"});e.code===200?(alert("删除成功"),h(),q()):alert(e.message||"删除失败")}catch(e){console.error("删除失败:",e),alert("删除失败")}}function O(s){if(!s)return null;const e=new Date(s),t=new Date;let k=t.getFullYear()-e.getFullYear();const B=t.getMonth()-e.getMonth();return(B<0||B===0&&t.getDate()<e.getDate())&&k--,k+"岁"}function Q(s){return s?new Date(s).toISOString().split("T")[0]:""}function E(s){return s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}return(s,e)=>(i(),r("div",sl,[e[53]||(e[53]=l("div",{class:"page-header"},[l("h1",null,"宠物档案管理"),l("p",null,"管理系统所有宠物信息")],-1)),y.value?(i(),r("div",al,[l("div",nl,[v(d(u),{icon:"mdi:paw",class:"stat-icon"}),l("div",ol,[l("h3",null,a(y.value.totalPets||0),1),e[17]||(e[17]=l("p",null,"总宠物数",-1))])]),l("div",il,[v(d(u),{icon:"mdi:account-group",class:"stat-icon"}),l("div",dl,[l("h3",null,a(y.value.totalOwners||0),1),e[18]||(e[18]=l("p",null,"宠物主人数",-1))])]),l("div",ul,[v(d(u),{icon:"mdi:cat",class:"stat-icon"}),l("div",rl,[l("h3",null,a(y.value.catCount||0),1),e[19]||(e[19]=l("p",null,"猫咪总数",-1))])]),l("div",vl,[v(d(u),{icon:"mdi:dog",class:"stat-icon"}),l("div",cl,[l("h3",null,a(y.value.dogCount||0),1),e[20]||(e[20]=l("p",null,"狗狗总数",-1))])])])):m("",!0),l("div",pl,[l("div",ml,[v(d(u),{icon:"mdi:magnify",class:"search-icon"}),p(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>T.value=t),placeholder:"搜索宠物名/品种/主人...",onKeyup:ll(A,["enter"])},null,544),[[g,T.value]]),l("button",{class:"search-btn",onClick:A},"搜索")]),l("button",{class:"add-btn",onClick:R},[v(d(u),{icon:"mdi:plus"}),e[21]||(e[21]=f(" 添加宠物 ",-1))])]),P.value?(i(),r("div",gl,[v(d(u),{icon:"mdi:loading",class:"spin"}),e[22]||(e[22]=l("span",null,"加载中...",-1))])):U.value.length===0?(i(),r("div",bl,[v(d(u),{icon:"mdi:paw",class:"empty-icon"}),e[23]||(e[23]=l("h3",null,"暂无宠物档案",-1)),e[24]||(e[24]=l("p",null,"点击上方按钮添加第一个宠物",-1))])):(i(),r("div",fl,[l("table",yl,[e[25]||(e[25]=l("thead",null,[l("tr",null,[l("th",null,"ID"),l("th",null,"宠物信息"),l("th",null,"主人ID"),l("th",null,"类型"),l("th",null,"品种"),l("th",null,"性别"),l("th",null,"年龄/体重"),l("th",null,"创建时间"),l("th",null,"操作")])],-1)),l("tbody",null,[(i(!0),r(el,null,tl(U.value,t=>(i(),r("tr",{key:t.id},[l("td",null,a(t.id),1),l("td",null,[l("div",hl,[l("div",_l,[t.avatarUrl?(i(),r("img",{key:0,src:t.avatarUrl,alt:t.name},null,8,wl)):(i(),z(d(u),{key:1,icon:"mdi:paw",class:"default-avatar"}))]),l("div",kl,[l("strong",null,a(t.name),1),t.color?(i(),r("small",Dl,"毛色："+a(t.color),1)):m("",!0)])])]),l("td",null,[l("div",Ul,[v(d(u),{icon:"mdi:account",class:"owner-icon"}),l("span",null,a(t.userId),1)])]),l("td",null,[l("span",{class:K(["type-badge",t.petType])},[v(d(u),{icon:t.petType==="狗"?"mdi:dog":"mdi:cat",class:"pet-type-icon"},null,8,["icon"]),f(" "+a(t.petType),1)],2)]),l("td",null,a(t.breed||"-"),1),l("td",null,[l("span",{class:K(["gender-badge",t.gender])},[v(d(u),{icon:t.gender==="公"?"mdi:gender-male":t.gender==="母"?"mdi:gender-female":"mdi:gender-non-binary",class:"gender-icon"},null,8,["icon"]),f(" "+a(t.gender),1)],2)]),l("td",null,[l("div",Cl,[t.age?(i(),r("span",Il,a(t.age),1)):m("",!0),t.weight?(i(),r("span",Tl,a(t.weight)+"kg",1)):m("",!0)])]),l("td",null,a(E(t.createdAt)),1),l("td",null,[l("div",Vl,[l("button",{class:"action-btn view",onClick:k=>j(t),title:"查看详情"},[v(d(u),{icon:"mdi:eye"})],8,xl),l("button",{class:"action-btn edit",onClick:k=>Y(t),title:"编辑"},[v(d(u),{icon:"mdi:pencil"})],8,Pl),l("button",{class:"action-btn delete",onClick:k=>J(t),title:"删除"},[v(d(u),{icon:"mdi:delete"})],8,Sl)])])]))),128))])])])),I.value>0?(i(),r("div",ql,[l("div",El,[e[27]||(e[27]=l("span",null,"每页显示",-1)),p(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),onChange:G},[...e[26]||(e[26]=[l("option",{value:10},"10 条",-1),l("option",{value:20},"20 条",-1),l("option",{value:50},"50 条",-1),l("option",{value:100},"100 条",-1)])],544),[[M,C.value,void 0,{number:!0}]])]),l("div",Ml,[l("button",{disabled:b.value===1,onClick:e[2]||(e[2]=t=>L(b.value-1))},"上一页",8,$l),l("span",zl,"第 "+a(b.value)+" / "+a(F.value)+" 页，共 "+a(I.value)+" 条",1),l("button",{disabled:b.value>=F.value,onClick:e[3]||(e[3]=t=>L(b.value+1))},"下一页",8,Fl)])])):m("",!0),V.value?(i(),r("div",{key:5,class:"dialog-overlay",onClick:x},[l("div",{class:"dialog",onClick:e[15]||(e[15]=$(()=>{},["stop"]))},[l("div",Al,[l("h3",null,a(_.value?"编辑宠物":"添加宠物"),1),l("button",{class:"close-btn",onClick:x},[v(d(u),{icon:"mdi:close"})])]),l("form",{class:"dialog-body",onSubmit:$(H,["prevent"])},[l("div",Ll,[l("div",Nl,[e[28]||(e[28]=l("label",null,[f("宠物名称 "),l("span",{class:"required"},"*")],-1)),p(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.name=t),required:"",placeholder:"请输入宠物名称",maxlength:"50"},null,512),[[g,n.value.name]])]),l("div",Ol,[e[30]||(e[30]=l("label",null,[f("宠物类型 "),l("span",{class:"required"},"*")],-1)),p(l("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.petType=t),required:""},[...e[29]||(e[29]=[l("option",{value:""},"请选择",-1),l("option",{value:"猫"},"猫",-1),l("option",{value:"狗"},"狗",-1)])],512),[[M,n.value.petType]])])]),l("div",Bl,[l("div",Kl,[e[31]||(e[31]=l("label",null,"品种",-1)),p(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.breed=t),placeholder:"请输入品种",maxlength:"100"},null,512),[[g,n.value.breed]])]),l("div",Gl,[e[33]||(e[33]=l("label",null,[f("性别 "),l("span",{class:"required"},"*")],-1)),p(l("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.gender=t),required:""},[...e[32]||(e[32]=[l("option",{value:""},"请选择",-1),l("option",{value:"公"},"公",-1),l("option",{value:"母"},"母",-1),l("option",{value:"未知"},"未知",-1)])],512),[[M,n.value.gender]])])]),l("div",Rl,[l("div",Yl,[e[34]||(e[34]=l("label",null,"出生日期",-1)),p(l("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.birthDate=t),type:"date",max:new Date().toISOString().split("T")[0]},null,8,jl),[[g,n.value.birthDate]])]),l("div",Hl,[e[35]||(e[35]=l("label",null,"体重 (kg)",-1)),p(l("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>n.value.weight=t),type:"number",step:"0.01",min:"0",max:"100",placeholder:"请输入体重"},null,512),[[g,n.value.weight]])])]),l("div",Jl,[e[36]||(e[36]=l("label",null,"毛色",-1)),p(l("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.color=t),placeholder:"请输入毛色描述",maxlength:"50"},null,512),[[g,n.value.color]])]),l("div",Ql,[e[37]||(e[37]=l("label",null,[f("主人用户ID "),l("span",{class:"required"},"*")],-1)),p(l("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.userId=t),type:"number",required:"",min:"1",placeholder:"请输入用户ID"},null,512),[[g,n.value.userId,void 0,{number:!0}]])]),l("div",Wl,[e[38]||(e[38]=l("label",null,"头像URL",-1)),p(l("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>n.value.avatarUrl=t),placeholder:"请输入头像图片URL",maxlength:"255"},null,512),[[g,n.value.avatarUrl]]),e[39]||(e[39]=l("small",{class:"hint"},"支持网络图片地址",-1))]),l("div",Xl,[e[40]||(e[40]=l("label",null,"性格描述",-1)),p(l("textarea",{"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.personality=t),placeholder:"请输入宠物的性格特点",rows:"3",maxlength:"255"},null,512),[[g,n.value.personality]])]),l("div",Zl,[e[41]||(e[41]=l("label",null,"特别记录/备注",-1)),p(l("textarea",{"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.notes=t),placeholder:"请输入健康情况等特别记录",rows:"4"},null,512),[[g,n.value.notes]])]),l("div",le,[l("button",{type:"button",class:"cancel-btn",onClick:x},"取消"),l("button",{type:"submit",class:"submit-btn",disabled:w.value},[w.value?(i(),z(d(u),{key:0,icon:"mdi:loading",class:"spin"})):m("",!0),f(" "+a(w.value?"保存中...":"保存"),1)],8,ee)])],32)])])):m("",!0),S.value?(i(),r("div",{key:6,class:"dialog-overlay",onClick:N},[l("div",{class:"dialog detail-dialog",onClick:e[16]||(e[16]=$(()=>{},["stop"]))},[l("div",te,[e[42]||(e[42]=l("h3",null,"宠物详情",-1)),l("button",{class:"close-btn",onClick:N},[v(d(u),{icon:"mdi:close"})])]),o.value?(i(),r("div",se,[l("div",ae,[l("div",ne,[o.value.avatarUrl?(i(),r("img",{key:0,src:o.value.avatarUrl,alt:o.value.name},null,8,oe)):(i(),z(d(u),{key:1,icon:"mdi:paw",class:"detail-default-avatar"}))]),l("div",ie,[l("h2",null,a(o.value.name),1),l("div",de,[l("span",ue,a(o.value.petType),1),l("span",re,a(o.value.gender),1),o.value.breed?(i(),r("span",ve,a(o.value.breed),1)):m("",!0)])])]),l("div",ce,[l("div",pe,[e[43]||(e[43]=l("label",null,"宠物ID",-1)),l("span",null,a(o.value.id),1)]),l("div",me,[e[44]||(e[44]=l("label",null,"主人用户ID",-1)),l("span",null,a(o.value.userId),1)]),l("div",ge,[e[45]||(e[45]=l("label",null,"出生日期",-1)),l("span",null,a(o.value.birthDate||"未知"),1)]),l("div",be,[e[46]||(e[46]=l("label",null,"年龄",-1)),l("span",null,a(O(o.value.birthDate)||"未知"),1)]),l("div",fe,[e[47]||(e[47]=l("label",null,"体重",-1)),l("span",null,a(o.value.weight?o.value.weight+"kg":"未记录"),1)]),l("div",ye,[e[48]||(e[48]=l("label",null,"毛色",-1)),l("span",null,a(o.value.color||"未记录"),1)]),l("div",he,[e[49]||(e[49]=l("label",null,"性格描述",-1)),l("p",null,a(o.value.personality||"暂无描述"),1)]),l("div",_e,[e[50]||(e[50]=l("label",null,"特别记录/备注",-1)),l("p",we,a(o.value.notes||"暂无记录"),1)]),l("div",ke,[e[51]||(e[51]=l("label",null,"创建时间",-1)),l("span",null,a(E(o.value.createdAt)),1)]),l("div",De,[e[52]||(e[52]=l("label",null,"更新时间",-1)),l("span",null,a(E(o.value.updatedAt)),1)])])])):m("",!0)])])):m("",!0)]))}},Te=W(Ue,[["__scopeId","data-v-4dee00d6"]]);export{Te as default};
