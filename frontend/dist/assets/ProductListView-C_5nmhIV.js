import{y as N,_ as vs,H as hs,r,o as _s,C as fs,d as i,e as t,i as j,f as gs,h as v,v as ms,I as ks,l as d,t as l,F as h,s as _,x as Q,J as ps,E as ys,T as Cs,m as bs,p as n,w as g,n as f}from"./index-D7KbY98F.js";import{g as x}from"./product-Dg8M0DH-.js";function ws(){return N({url:"/api/favorites",method:"GET"})}function xs(M){return N({url:"/api/favorites",method:"POST",data:{productId:M}})}function Ps(M){return N({url:`/api/favorites/${M}`,method:"DELETE"})}const $s={class:"product-list-page"},Ts={class:"search-section"},Fs={class:"container"},Ss={class:"search-bar"},Ls={key:0,class:"search-info"},Es={class:"category-nav"},Ms={class:"container"},Bs={class:"categories"},Rs=["onClick"],Vs={class:"container"},Ws={key:0,class:"search-results-section"},Hs={key:0,class:"empty-search"},zs={key:1,class:"product-grid"},Ns=["onClick"],qs={class:"product-image"},As=["src","alt"],Ds={key:0,class:"product-tag"},Is={class:"product-info"},Ks={class:"product-title"},Os={class:"product-price"},Us={key:0,class:"original-price"},Gs={class:"product-rating"},Js={class:"rating-count"},Xs={class:"product-actions"},Ys=["onClick"],js=["onClick"],Qs={key:1},Zs={class:"banner-carousel"},st=["onClick"],tt=["src","alt","onLoad"],et={class:"carousel-indicators"},at=["onClick"],ot={class:"featured-section"},it={class:"section-header"},nt={class:"scroll-controls"},lt={class:"featured-products"},ct=["onClick"],rt={class:"featured-image"},dt=["src","alt"],ut={key:0,class:"featured-tag"},vt={class:"featured-info"},ht={class:"featured-title"},_t={class:"featured-price"},ft={key:0,class:"featured-original-price"},gt=["onClick"],mt={class:"product-grid"},kt=["onClick"],pt={class:"product-image"},yt=["src","alt"],Ct={key:0,class:"product-tag"},bt={class:"product-info"},wt={class:"product-title"},xt={class:"product-price"},Pt={key:0,class:"original-price"},$t={class:"product-rating"},Tt={class:"rating-count"},Ft={class:"product-actions"},St=["onClick"],Lt=["onClick"],Et={class:"product-grid"},Mt=["onClick"],Bt={class:"product-image"},Rt=["src","alt"],Vt={key:0,class:"product-tag"},Wt={class:"product-info"},Ht={class:"product-title"},zt={class:"product-price"},Nt={key:0,class:"original-price"},qt={class:"product-rating"},At={class:"rating-count"},Dt={class:"product-actions"},It=["onClick"],Kt=["onClick"],Ot={class:"tips-section"},Ut={class:"tips-content"},Gt={class:"product-grid"},Jt=["onClick"],Xt={class:"product-image"},Yt=["src","alt"],jt={key:0,class:"product-tag"},Qt={class:"product-info"},Zt={class:"product-title"},se={class:"product-price"},te={key:0,class:"original-price"},ee={class:"product-rating"},ae={class:"rating-count"},oe={class:"product-actions"},ie=["onClick"],ne=["onClick"],le={class:"product-grid"},ce=["onClick"],re={class:"product-image"},de=["src","alt"],ue={key:0,class:"product-tag"},ve={class:"product-info"},he={class:"product-title"},_e={class:"product-price"},fe={key:0,class:"original-price"},ge={class:"product-rating"},me={class:"rating-count"},ke={class:"product-actions"},pe=["onClick"],ye=["onClick"],Ce={key:0,class:"notification"},be={__name:"ProductListView",setup(M){const W=bs(),Z=hs(),q=r("food"),A=r(!1),k=r([]),$=r({show:!1,message:""}),C=r(""),B=r(!1),b=r([]),T=r(null),D=r([]),F=r([]),m=r(0),p=r(null),H=r([]);let R=0,V=0;const ss=(o,e)=>{if(!p.value)return;const s=e.target,{naturalWidth:a,naturalHeight:c}=s;R=p.value.clientWidth,V=p.value.clientHeight;const y=Math.max(R/a,V/c),ds=a*y,us=c*y;H.value[o]={width:ds+"px",height:us+"px"}},I=()=>{if(!p.value)return;R=p.value.clientWidth,V=p.value.clientHeight,p.value.querySelectorAll(".carousel-item img").forEach((e,s)=>{if(e.complete&&e.naturalWidth){const{naturalWidth:a,naturalHeight:c}=e,y=Math.max(R/a,V/c);H.value[s]={width:a*y+"px",height:c*y+"px"}}})},ts=[{id:"food",name:"宠物食品",icon:"fas fa-bone"},{id:"supply",name:"宠物用品",icon:"fas fa-utensils"},{id:"toy",name:"宠物玩具",icon:"fas fa-baseball-ball"},{id:"sale",name:"限时特惠",icon:"fas fa-tags"}],K=o=>{if(!T.value)return;const e=300,s=T.value.scrollLeft;o==="left"?T.value.scrollTo({left:s-e,behavior:"smooth"}):T.value.scrollTo({left:s+e,behavior:"smooth"})},es=()=>{m.value>0?m.value--:m.value=F.value.length-1},as=()=>{m.value<F.value.length-1?m.value++:m.value=0},os=o=>{m.value=o},is=[{title:"如何选择宠物食品",content:"根据宠物年龄、品种和健康状况选择合适的主粮，注意查看成分表和营养配比。"},{title:"宠物日常护理",content:"定期为宠物梳理毛发、清洁耳朵、修剪指甲，保持宠物清洁健康。"},{title:"宠物健康检查",content:"建议每年为宠物进行一次全面体检，及时接种疫苗，预防疾病发生。"}],O=r([]),U=r([]),G=r([]),J=r([]),S=(o,e)=>o<=Math.floor(e)?"fas fa-star":o===Math.ceil(e)&&e%1!==0?"fas fa-star-half-alt":"far fa-star",ns=o=>{q.value=o,z();const s={food:"宠物食品",supply:"宠物用品",toy:"宠物玩具",sale:"热门推荐"}[o];s&&setTimeout(()=>{const a=document.querySelectorAll(".section-title");for(const c of a)if(c.textContent.includes(s)){c.scrollIntoView({behavior:"smooth",block:"start"}),c.style.color="#ffb347",setTimeout(()=>{c.style.color="#5a4a42"},2e3);break}},100)},w=o=>{W.push(`/product/${o}`)},P=async o=>{try{await Z.addItem({productId:o.id,spec:"标准装",quantity:1}),u(`已将 ${o.name} 加入购物车`)}catch(e){e.message==="请先登录"?(u("请先登录"),setTimeout(()=>W.push("/auth"),1e3)):u("添加失败，请重试")}},L=async o=>{try{const e=k.value.indexOf(o);if(e>-1){const s=await Ps(o);s.code===200?(k.value.splice(e,1),u("已从收藏夹移除")):u("取消收藏失败："+(s.message||"未知错误"))}else{const s=await xs(o);s.code===200?(k.value.push(o),u("已添加到收藏夹")):s.code===500&&s.message&&s.message.includes("已在收藏列表中")?(k.value.includes(o)||k.value.push(o),u("商品已在收藏列表中")):u("添加收藏失败："+(s.message||"未知错误"))}}catch(e){console.error("收藏操作失败:",e),e.message&&e.message.includes("401")?(u("请先登录"),setTimeout(()=>W.push("/auth"),1e3)):u("收藏操作失败，请重试")}},E=o=>k.value.includes(o),u=o=>{$.value.show=!0,$.value.message=o,setTimeout(()=>$.value.show=!1,3e3)},ls=()=>{window.scrollTo({top:0,behavior:"smooth"})},X=async()=>{if(!C.value.trim()){u("请输入搜索关键词");return}try{B.value=!0;const o=await x({keyword:C.value.trim(),page:1,pageSize:50});o.code===200&&o.data?(b.value=o.data,u(`找到 ${b.value.length} 件相关商品`)):(b.value=[],u("没有找到相关商品"))}catch(o){console.error("搜索失败:",o),u("搜索失败，请重试")}},z=()=>{C.value="",B.value=!1,b.value=[]},Y=()=>{A.value=window.scrollY>300},cs=async()=>{try{const o=await ws();o.code===200&&o.data&&(k.value=o.data.map(e=>e.id))}catch(o){console.error("加载收藏列表失败:",o),k.value=[]}},rs=async()=>{try{const o=await x({category:"hot",limit:3});o.code===200&&(F.value=o.data);const e=await x({category:"hot",limit:10});e.code===200&&(D.value=e.data);const s=await x({category:"hot",limit:5});s.code===200&&(O.value=s.data);const a=await x({category:"food",limit:5});a.code===200&&(U.value=a.data);const c=await x({category:"supply",limit:5});c.code===200&&(G.value=c.data);const y=await x({category:"toy",limit:5});y.code===200&&(J.value=y.data)}catch(o){console.error("加载商品失败:",o),u("加载商品数据失败,请检查后端服务是否启动")}};return _s(()=>{rs(),cs(),window.addEventListener("scroll",Y),window.addEventListener("resize",I)}),fs(()=>{window.removeEventListener("scroll",Y),window.removeEventListener("resize",I)}),(o,e)=>(n(),i("div",$s,[t("div",Ts,[t("div",Fs,[t("div",Ss,[j(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>C.value=s),type:"text",placeholder:"搜索商品名称、品牌...",onKeyup:ks(X,["enter"]),class:"search-input"},null,544),[[ms,C.value]]),t("button",{onClick:X,class:"search-btn"},[...e[3]||(e[3]=[t("i",{class:"fas fa-search"},null,-1),d(" 搜索 ",-1)])]),C.value?(n(),i("button",{key:0,onClick:z,class:"clear-btn"},[...e[4]||(e[4]=[t("i",{class:"fas fa-times"},null,-1),d(" 清除 ",-1)])])):v("",!0)]),B.value?(n(),i("div",Ls,' 搜索 "'+l(C.value)+'" 的结果 ，共找到 '+l(b.value.length)+" 件商品 ",1)):v("",!0)])]),t("nav",Es,[t("div",Ms,[t("ul",Bs,[(n(),i(h,null,_(ts,s=>t("li",{key:s.id},[t("a",{href:"#",class:f({active:q.value===s.id}),onClick:g(a=>ns(s.id),["prevent"])},[t("i",{class:f(s.icon)},null,2),d(" "+l(s.name),1)],10,Rs)])),64))])])]),t("div",Vs,[B.value?(n(),i("div",Ws,[e[8]||(e[8]=t("h2",{class:"section-title"},"搜索结果",-1)),b.value.length===0?(n(),i("div",Hs,[e[5]||(e[5]=t("i",{class:"fas fa-search empty-icon"},null,-1)),e[6]||(e[6]=t("p",null,"没有找到相关商品",-1)),t("button",{onClick:z,class:"back-btn"},"返回商品列表")])):(n(),i("div",zs,[(n(!0),i(h,null,_(b.value,s=>(n(),i("div",{key:s.id,class:"product-card",onClick:a=>w(s.id)},[t("div",qs,[t("img",{src:s.image,alt:s.name},null,8,As),s.tag?(n(),i("span",Ds,l(s.tag),1)):v("",!0)]),t("div",Is,[t("div",Ks,l(s.name),1),t("div",Os,[d(" ¥"+l(s.price.toFixed(2))+" ",1),s.originalPrice?(n(),i("span",Us," ¥"+l(s.originalPrice.toFixed(2)),1)):v("",!0)]),t("div",Gs,[(n(),i(h,null,_(5,a=>t("i",{key:a,class:f(S(a,s.rating))},null,2)),64)),t("span",Js,"("+l(s.ratingCount)+")",1)]),t("div",Xs,[t("button",{class:"add-to-cart",onClick:g(a=>P(s),["stop"])},[...e[7]||(e[7]=[t("i",{class:"fas fa-cart-plus"},null,-1),d(" 加入购物车 ",-1)])],8,Ys),t("button",{class:"wishlist-btn",onClick:g(a=>L(s.id),["stop"])},[t("i",{class:f(E(s.id)?"fas fa-heart":"far fa-heart")},null,2)],8,js)])])],8,Ns))),128))]))])):(n(),i("div",Qs,[t("div",Zs,[t("button",{onClick:es,class:"carousel-btn prev-btn"},[...e[9]||(e[9]=[t("i",{class:"fas fa-chevron-left"},null,-1)])]),t("div",{class:"carousel-container",ref_key:"carouselContainer",ref:p},[t("div",{class:"carousel-track",style:Q({transform:`translateX(-${m.value*100}%)`})},[(n(!0),i(h,null,_(F.value,(s,a)=>(n(),i("div",{key:s.id,class:"carousel-item",onClick:c=>w(s.id)},[t("img",{src:s.image,alt:s.name,style:Q(H.value[a]),onLoad:c=>ss(a,c)},null,44,tt)],8,st))),128))],4)],512),t("button",{onClick:as,class:"carousel-btn next-btn"},[...e[10]||(e[10]=[t("i",{class:"fas fa-chevron-right"},null,-1)])]),t("div",et,[(n(!0),i(h,null,_(F.value,(s,a)=>(n(),i("span",{key:a,class:f(["indicator",{active:a===m.value}]),onClick:c=>os(a)},null,10,at))),128))])]),t("div",ot,[t("div",it,[e[13]||(e[13]=t("h2",{class:"section-title"},"⭐ 精选推荐",-1)),t("div",nt,[t("button",{onClick:e[1]||(e[1]=s=>K("left")),class:"scroll-btn"},[...e[11]||(e[11]=[t("i",{class:"fas fa-chevron-left"},null,-1)])]),t("button",{onClick:e[2]||(e[2]=s=>K("right")),class:"scroll-btn"},[...e[12]||(e[12]=[t("i",{class:"fas fa-chevron-right"},null,-1)])])])]),t("div",{class:"featured-scroll",ref_key:"featuredScroll",ref:T},[t("div",lt,[(n(!0),i(h,null,_(D.value,s=>(n(),i("div",{key:s.id,class:"featured-card",onClick:a=>w(s.id)},[t("div",rt,[t("img",{src:s.image,alt:s.name},null,8,dt),s.tag?(n(),i("span",ut,l(s.tag),1)):v("",!0)]),t("div",vt,[t("div",ht,l(s.name),1),t("div",_t,[d(" ¥"+l(s.price.toFixed(2))+" ",1),s.originalPrice?(n(),i("span",ft," ¥"+l(s.originalPrice.toFixed(2)),1)):v("",!0)]),t("button",{class:"featured-cart-btn",onClick:g(a=>P(s),["stop"])},[...e[14]||(e[14]=[t("i",{class:"fas fa-cart-plus"},null,-1),d(" 加入购物车 ",-1)])],8,gt)])],8,ct))),128))])],512)]),e[20]||(e[20]=t("h2",{class:"section-title"},"热门推荐",-1)),t("div",mt,[(n(!0),i(h,null,_(O.value,s=>(n(),i("div",{key:s.id,class:"product-card",onClick:a=>w(s.id)},[t("div",pt,[t("img",{src:s.image,alt:s.name},null,8,yt),s.tag?(n(),i("span",Ct,l(s.tag),1)):v("",!0)]),t("div",bt,[t("div",wt,l(s.name),1),t("div",xt,[d(" ¥"+l(s.price.toFixed(2))+" ",1),s.originalPrice?(n(),i("span",Pt," ¥"+l(s.originalPrice.toFixed(2)),1)):v("",!0)]),t("div",$t,[(n(),i(h,null,_(5,a=>t("i",{key:a,class:f(S(a,s.rating))},null,2)),64)),t("span",Tt,"("+l(s.ratingCount)+")",1)]),t("div",Ft,[t("button",{class:"add-to-cart",onClick:g(a=>P(s),["stop"])},[...e[15]||(e[15]=[t("i",{class:"fas fa-cart-plus"},null,-1),d(" 加入购物车 ",-1)])],8,St),t("button",{class:"wishlist-btn",onClick:g(a=>L(s.id),["stop"])},[t("i",{class:f(E(s.id)?"fas fa-heart":"far fa-heart")},null,2)],8,Lt)])])],8,kt))),128))]),e[21]||(e[21]=t("h2",{class:"section-title"},"宠物食品",-1)),t("div",Et,[(n(!0),i(h,null,_(U.value,s=>(n(),i("div",{key:s.id,class:"product-card",onClick:a=>w(s.id)},[t("div",Bt,[t("img",{src:s.image,alt:s.name},null,8,Rt),s.tag?(n(),i("span",Vt,l(s.tag),1)):v("",!0)]),t("div",Wt,[t("div",Ht,l(s.name),1),t("div",zt,[d(" ¥"+l(s.price.toFixed(2))+" ",1),s.originalPrice?(n(),i("span",Nt," ¥"+l(s.originalPrice.toFixed(2)),1)):v("",!0)]),t("div",qt,[(n(),i(h,null,_(5,a=>t("i",{key:a,class:f(S(a,s.rating))},null,2)),64)),t("span",At,"("+l(s.ratingCount)+")",1)]),t("div",Dt,[t("button",{class:"add-to-cart",onClick:g(a=>P(s),["stop"])},[...e[16]||(e[16]=[t("i",{class:"fas fa-cart-plus"},null,-1),d(" 加入购物车 ",-1)])],8,It),t("button",{class:"wishlist-btn",onClick:g(a=>L(s.id),["stop"])},[t("i",{class:f(E(s.id)?"fas fa-heart":"far fa-heart")},null,2)],8,Kt)])])],8,Mt))),128))]),t("div",Ot,[e[17]||(e[17]=t("h2",{class:"tips-title"},[t("i",{class:"fas fa-lightbulb"}),d(" 养宠小贴士")],-1)),t("div",Ut,[(n(),i(h,null,_(is,s=>t("div",{key:s.title,class:"tip-item"},[t("h4",null,l(s.title),1),t("p",null,l(s.content),1)])),64))])]),e[22]||(e[22]=t("h2",{class:"section-title"},"宠物用品",-1)),t("div",Gt,[(n(!0),i(h,null,_(G.value,s=>(n(),i("div",{key:s.id,class:"product-card",onClick:a=>w(s.id)},[t("div",Xt,[t("img",{src:s.image,alt:s.name},null,8,Yt),s.tag?(n(),i("span",jt,l(s.tag),1)):v("",!0)]),t("div",Qt,[t("div",Zt,l(s.name),1),t("div",se,[d(" ¥"+l(s.price.toFixed(2))+" ",1),s.originalPrice?(n(),i("span",te," ¥"+l(s.originalPrice.toFixed(2)),1)):v("",!0)]),t("div",ee,[(n(),i(h,null,_(5,a=>t("i",{key:a,class:f(S(a,s.rating))},null,2)),64)),t("span",ae,"("+l(s.ratingCount)+")",1)]),t("div",oe,[t("button",{class:"add-to-cart",onClick:g(a=>P(s),["stop"])},[...e[18]||(e[18]=[t("i",{class:"fas fa-cart-plus"},null,-1),d(" 加入购物车 ",-1)])],8,ie),t("button",{class:"wishlist-btn",onClick:g(a=>L(s.id),["stop"])},[t("i",{class:f(E(s.id)?"fas fa-heart":"far fa-heart")},null,2)],8,ne)])])],8,Jt))),128))]),e[23]||(e[23]=t("h2",{class:"section-title"},"宠物玩具",-1)),t("div",le,[(n(!0),i(h,null,_(J.value,s=>(n(),i("div",{key:s.id,class:"product-card",onClick:a=>w(s.id)},[t("div",re,[t("img",{src:s.image,alt:s.name},null,8,de),s.tag?(n(),i("span",ue,l(s.tag),1)):v("",!0)]),t("div",ve,[t("div",he,l(s.name),1),t("div",_e,[d(" ¥"+l(s.price.toFixed(2))+" ",1),s.originalPrice?(n(),i("span",fe," ¥"+l(s.originalPrice.toFixed(2)),1)):v("",!0)]),t("div",ge,[(n(),i(h,null,_(5,a=>t("i",{key:a,class:f(S(a,s.rating))},null,2)),64)),t("span",me,"("+l(s.ratingCount)+")",1)]),t("div",ke,[t("button",{class:"add-to-cart",onClick:g(a=>P(s),["stop"])},[...e[19]||(e[19]=[t("i",{class:"fas fa-cart-plus"},null,-1),d(" 加入购物车 ",-1)])],8,pe),t("button",{class:"wishlist-btn",onClick:g(a=>L(s.id),["stop"])},[t("i",{class:f(E(s.id)?"fas fa-heart":"far fa-heart")},null,2)],8,ye)])])],8,ce))),128))])]))]),j(t("button",{class:"back-to-top",onClick:ls},[...e[24]||(e[24]=[t("i",{class:"fas fa-chevron-up"},null,-1)])],512),[[ps,A.value]]),gs(Cs,{name:"notification"},{default:ys(()=>[$.value.show?(n(),i("div",Ce,[e[25]||(e[25]=t("i",{class:"fas fa-check-circle"},null,-1)),d(" "+l($.value.message),1)])):v("",!0)]),_:1})]))}},Pe=vs(be,[["__scopeId","data-v-47d442b3"]]);export{Pe as default};
