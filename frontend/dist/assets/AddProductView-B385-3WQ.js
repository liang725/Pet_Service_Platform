import{_ as T,r as p,o as E,b as H,y as w,d as U,e as l,f as d,l as i,q as n,K as r,t as V,w as g,i as a,v as u,D as F,n as G,L as h,k as L,h as S,m as A,p as b}from"./index-D7KbY98F.js";const z={class:"add-product"},O={class:"page-header"},$={class:"form-container"},J={class:"form-section"},K={class:"form-row"},W={class:"form-group"},j={class:"form-group"},Q={class:"form-row"},X={class:"form-group"},Y={class:"price-input"},Z={class:"form-group"},ee={class:"price-input"},le={class:"form-group"},oe={class:"form-group full-width"},se={class:"upload-container"},te={class:"upload-area"},ae={class:"upload-methods"},ie={class:"upload-icon"},ne={class:"upload-box url-upload"},re={class:"upload-icon"},de={class:"upload-text"},ue={class:"preview-area"},pe={key:0,class:"preview-box has-image"},ce=["src"],ve={key:1,class:"preview-box empty"},me={class:"form-group"},fe={class:"form-group"},ge={class:"form-row"},be={class:"form-group"},ye={class:"form-group full-width"},ke={class:"checkbox-group"},we={class:"checkbox-item"},Ue={class:"checkbox-label"},he={class:"checkbox-item"},xe={class:"checkbox-label"},_e={class:"checkbox-item"},Ve={class:"checkbox-label"},De={class:"form-actions"},Ie=["disabled"],Pe={__name:"AddProductView",setup(qe){const x=H(),D=A(),c=p(!1),v=p(!1),y=p(null),m=p(!1),f=p(!1),o=p({name:"",categoryId:null,price:null,originalPrice:null,stock:0,sales:0,imageUrl:"",shortDescription:"",description:"",tag:"",isRecommended:!1,isHot:!1,isNew:!1});E(()=>{x.params.id&&(v.value=!0,y.value=x.params.id,I())});async function I(){try{const t=await w({url:`/api/admin/products/${y.value}`,method:"GET"});if(t.code===200){const e=t.data;o.value={name:e.name||"",categoryId:e.categoryId||null,price:e.price||null,originalPrice:e.originalPrice||null,stock:e.stock||0,sales:e.sales||0,imageUrl:e.imageUrl||"",shortDescription:e.shortDescription||"",description:e.description||"",tag:e.tag||"",isRecommended:e.isRecommended||!1,isHot:e.isHot||!1,isNew:e.isNew||!1}}}catch(t){console.error("加载商品失败:",t),alert("加载商品失败")}}async function P(){c.value=!0;try{let t;v.value?t=await w({url:`/api/admin/products/${y.value}`,method:"PUT",data:o.value}):t=await w({url:"/api/admin/products",method:"POST",data:o.value}),t.code===200?(alert(v.value?"更新成功":"添加成功"),k()):alert(t.message||"操作失败")}catch(t){console.error("保存失败:",t),alert("保存失败")}finally{c.value=!1}}function k(){D.push("/admin/products")}function q(t){t.target.style.display="none"}function N(){o.value.imageUrl=""}function R(){f.value=!0}function B(){f.value=!1}function C(t){f.value=!1;const e=t.dataTransfer.files[0];e&&_(e)}async function M(t){const e=t.target.files[0];e&&_(e)}async function _(t){if(!t.type.startsWith("image/")){alert("请选择图片文件");return}if(t.size>5*1024*1024){alert("图片大小不能超过 5MB");return}m.value=!0;try{const e=new FileReader;e.onload=s=>{o.value.imageUrl=s.target.result,m.value=!1,alert("图片上传成功")},e.onerror=()=>{m.value=!1,alert("图片读取失败")},e.readAsDataURL(t)}catch(e){console.error("上传失败:",e),alert("图片上传失败"),m.value=!1}}return(t,e)=>(b(),U("div",z,[l("div",O,[l("button",{class:"back-btn",onClick:k},[d(n(r),{icon:"mdi:arrow-left"}),e[12]||(e[12]=i(" 返回商品列表 ",-1))]),l("h1",null,V(v.value?"编辑商品":"添加商品"),1)]),l("div",$,[l("form",{onSubmit:g(P,["prevent"]),class:"product-form"},[l("div",J,[l("div",K,[l("div",W,[e[13]||(e[13]=l("label",null,[i("商品名称 "),l("span",{class:"required"},"*")],-1)),a(l("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.name=s),required:"",placeholder:"请输入商品名称"},null,512),[[u,o.value.name]])]),l("div",j,[e[15]||(e[15]=l("label",null,[i("商品分类 "),l("span",{class:"required"},"*")],-1)),a(l("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.categoryId=s),required:""},[...e[14]||(e[14]=[l("option",{value:null},"请选择分类",-1),l("option",{value:1},"宠物食品",-1),l("option",{value:2},"宠物用品",-1),l("option",{value:3},"宠物玩具",-1),l("option",{value:4},"宠物服饰",-1),l("option",{value:5},"宠物医疗",-1)])],512),[[F,o.value.categoryId,void 0,{number:!0}]])])]),l("div",Q,[l("div",X,[e[17]||(e[17]=l("label",null,[i("当前价格 "),l("span",{class:"required"},"*")],-1)),l("div",Y,[e[16]||(e[16]=l("span",{class:"currency"},"¥",-1)),a(l("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.price=s),type:"number",step:"0.01",required:"",placeholder:"0.00"},null,512),[[u,o.value.price,void 0,{number:!0}]])])]),l("div",Z,[e[19]||(e[19]=l("label",null,"原价",-1)),l("div",ee,[e[18]||(e[18]=l("span",{class:"currency"},"¥",-1)),a(l("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.originalPrice=s),type:"number",step:"0.01",placeholder:"0.00"},null,512),[[u,o.value.originalPrice,void 0,{number:!0}]])])]),l("div",le,[e[20]||(e[20]=l("label",null,[i("库存数量 "),l("span",{class:"required"},"*")],-1)),a(l("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.stock=s),type:"number",required:"",placeholder:"0"},null,512),[[u,o.value.stock,void 0,{number:!0}]])])]),l("div",oe,[e[26]||(e[26]=l("label",null,[i("商品图片 "),l("span",{class:"required"},"*")],-1)),l("div",se,[l("div",te,[l("div",ae,[l("label",{class:G(["upload-box local-upload",{"drag-over":f.value}]),onDragover:g(R,["prevent"]),onDragleave:g(B,["prevent"]),onDrop:g(C,["prevent"])},[l("input",{type:"file",accept:"image/*",onChange:M,hidden:""},null,32),l("div",ie,[d(n(r),{icon:"mdi:cloud-upload"})]),e[21]||(e[21]=l("div",{class:"upload-text"},[l("h4",null,"本地上传"),l("p",null,"点击选择或拖拽图片文件")],-1)),e[22]||(e[22]=l("div",{class:"upload-hint"},"支持 JPG、PNG、GIF，最大 5MB",-1))],34),l("div",ne,[l("div",re,[d(n(r),{icon:"mdi:link-variant"})]),l("div",de,[e[23]||(e[23]=l("h4",null,"图片链接",-1)),a(l("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.imageUrl=s),placeholder:"输入图片URL地址",class:"url-input"},null,512),[[u,o.value.imageUrl]])])])])]),l("div",ue,[e[25]||(e[25]=l("div",{class:"preview-label"},"图片预览",-1)),o.value.imageUrl?(b(),U("div",pe,[l("img",{src:o.value.imageUrl,alt:"商品预览",onError:q},null,40,ce),l("button",{type:"button",class:"remove-image",onClick:N,title:"删除图片"},[d(n(r),{icon:"mdi:close-circle"})])])):(b(),U("div",ve,[d(n(r),{icon:"mdi:image-outline"}),e[24]||(e[24]=l("p",null,"暂无图片",-1))]))])])]),l("div",me,[e[27]||(e[27]=l("label",null,"简短描述",-1)),a(l("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.value.shortDescription=s),placeholder:"一句话描述商品特点"},null,512),[[u,o.value.shortDescription]])]),l("div",fe,[e[28]||(e[28]=l("label",null,"详细描述",-1)),a(l("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.value.description=s),rows:"4",placeholder:"请输入商品的详细描述信息"},null,512),[[u,o.value.description]])]),l("div",ge,[l("div",be,[e[29]||(e[29]=l("label",null,"商品标签",-1)),a(l("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o.value.tag=s),placeholder:"例如：热销、新品、推荐"},null,512),[[u,o.value.tag]])])]),l("div",ye,[e[33]||(e[33]=l("label",null,"商品特性",-1)),l("div",ke,[l("label",we,[a(l("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=s=>o.value.isRecommended=s)},null,512),[[h,o.value.isRecommended]]),l("span",Ue,[d(n(r),{icon:"mdi:star",class:"icon-recommended"}),e[30]||(e[30]=i(" 推荐商品 ",-1))])]),l("label",he,[a(l("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=s=>o.value.isHot=s)},null,512),[[h,o.value.isHot]]),l("span",xe,[d(n(r),{icon:"mdi:fire",class:"icon-hot"}),e[31]||(e[31]=i(" 热销商品 ",-1))])]),l("label",_e,[a(l("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=s=>o.value.isNew=s)},null,512),[[h,o.value.isNew]]),l("span",Ve,[d(n(r),{icon:"mdi:new-box",class:"icon-new"}),e[32]||(e[32]=i(" 新品上市 ",-1))])])])])]),l("div",De,[l("button",{type:"button",class:"cancel-btn",onClick:k},"取消"),l("button",{type:"submit",class:"submit-btn",disabled:c.value},[c.value?(b(),L(n(r),{key:0,icon:"mdi:loading",class:"spin"})):S("",!0),i(" "+V(c.value?"保存中...":v.value?"更新商品":"创建商品"),1)],8,Ie)])],32)])]))}},Re=T(Pe,[["__scopeId","data-v-ccba5d72"]]);export{Re as default};
