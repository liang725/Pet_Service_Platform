import{_ as ue,r,c as W,o as ce,y as I,d as i,e,h as v,n as y,f as c,q as d,K as u,t as l,i as T,v as X,I as re,l as m,L as ve,D as L,F as K,s as R,w as Y,k as me,p as o}from"./index-D7KbY98F.js";const pe={class:"appointment-management"},_e={class:"stats-cards"},fe={class:"stat-content"},ge={class:"stat-number"},ye={class:"stat-content"},be={class:"stat-number"},he={class:"stat-content"},ke={class:"stat-number"},Ce={class:"stat-content"},we={class:"stat-number"},De={class:"stat-content"},Te={class:"stat-number"},Se={class:"toolbar"},xe={class:"search-box"},$e={class:"filter-group"},Ie={class:"filter-item"},Ne={class:"checkbox-label"},Ve={class:"filter-item"},Ae={key:0,class:"loading-state"},Pe={key:1,class:"empty-state"},Fe={key:0},Me={key:1},ze={key:2,class:"table-container"},Ee={class:"appointment-table"},Ue={class:"order-no"},qe={class:"user-info"},Be={class:"user-name"},Le={key:0,class:"user-phone"},Ke={key:1,class:"user-id"},Re={class:"pet-info"},Ge={class:"pet-name"},Oe={class:"pet-type"},je={class:"time-info"},He={class:"appointment-date"},Je={class:"time-slot"},Qe={class:"service-info"},We={class:"service-name"},Xe=["title"],Ye={class:"amount"},Ze={class:"action-buttons"},et=["onClick"],tt=["onClick"],st=["onClick"],lt={key:3,class:"pagination"},nt={class:"page-size-selector"},at={class:"page-controls"},ot=["disabled"],it={class:"page-info"},dt=["disabled"],ut={class:"dialog-header"},ct={key:0,class:"dialog-loading"},rt={key:1,class:"dialog-body"},vt={class:"detail-section"},mt={class:"info-grid"},pt={class:"info-item"},_t={class:"info-item"},ft={class:"info-item"},gt={class:"info-item"},yt={class:"info-item"},bt={class:"info-item"},ht={class:"detail-section"},kt={class:"pet-detail"},Ct={class:"pet-avatar"},wt={class:"pet-info-detail"},Dt={class:"pet-name"},Tt={class:"pet-details"},St={key:0},xt={key:1},$t={class:"detail-section"},It={class:"service-header"},Nt={class:"service-name"},Vt={class:"service-price"},At={key:0,class:"service-desc"},Pt={class:"service-meta"},Ft={key:0},Mt={key:0,class:"detail-section"},zt={class:"care-items"},Et={class:"care-header"},Ut={class:"care-name"},qt={class:"care-price"},Bt={key:0,class:"care-desc"},Lt={class:"care-category"},Kt={class:"detail-section"},Rt={class:"amount-summary"},Gt={class:"amount-item"},Ot={class:"amount-item"},jt={class:"amount-item"},Ht={class:"amount-item total"},Jt={key:1,class:"detail-section"},Qt={key:0,class:"notes"},Wt={key:1,class:"notes"},Xt={class:"dialog-header"},Yt={class:"dialog-body"},Zt={class:"appointment-info"},es={class:"info-row"},ts={class:"info-row"},ss={class:"form-group"},ls={key:0,class:"form-group"},ns={class:"dialog-actions"},as=["disabled"],os={__name:"AppointmentManagementView",setup(is){const P=r([]),F=r(!1),p=r(1),N=r(10),V=r(0),h=r(""),_=r("all"),S=r(!1),k=r(""),C=r({all:0,pending:0,confirmed:0,completed:0,cancelled:0}),M=r(!1),z=r(!1),E=r(!1),a=r(null),w=r(null),g=r(""),D=r(""),x=r(!1),G=W(()=>Math.ceil(V.value/N.value)),Z=W(()=>h.value||_.value!=="all"||S.value||k.value!=="");ce(()=>{U(),f()});async function U(){try{const n=await I({url:"/api/admin/appointments/stats",method:"GET"});n.code===200&&(C.value=n.data)}catch(n){console.error("加载统计信息失败:",n)}}async function f(){F.value=!0;try{const n={page:p.value,pageSize:N.value};if(h.value&&(n.keyword=h.value),_.value!=="all"&&(n.status=_.value),S.value){const s=new Date().toISOString().split("T")[0];n.today=s}k.value&&(n.petType=k.value);const t=await I({url:"/api/admin/appointments",method:"GET",params:n});t.code===200&&(P.value=t.data.list||[],V.value=t.data.total||0)}catch(n){console.error("加载预约列表失败:",n),alert("加载预约列表失败")}finally{F.value=!1}}function O(){p.value=1,f()}function $(n){_.value=n,p.value=1,f()}function ee(){f()}function te(){f()}function se(){h.value="",_.value="all",S.value=!1,k.value="",p.value=1,f()}function j(n){p.value=n,f()}function le(){p.value=1,f()}async function ne(n){M.value=!0,E.value=!0;try{const t=await I({url:`/api/admin/appointments/${n}`,method:"GET"});t.code===200?a.value=t.data:alert(t.message||"获取详情失败")}catch(t){console.error("获取详情失败:",t),alert("获取详情失败")}finally{E.value=!1}}function ae(n){w.value=n,g.value=n.status,D.value=n.cancellation_reason||"",z.value=!0}async function oe(){if(!g.value){alert("请选择状态");return}if(g.value==="cancelled"&&!D.value.trim()){alert("取消预约必须填写原因");return}x.value=!0;try{const n={status:g.value};g.value==="cancelled"&&(n.reason=D.value.trim());const t=await I({url:`/api/admin/appointments/${w.value.id}/status`,method:"PUT",data:n});t.code===200?(alert("状态修改成功"),A(),U(),f()):alert(t.message||"状态修改失败")}catch(n){console.error("状态修改失败:",n),alert("状态修改失败")}finally{x.value=!1}}async function ie(n){if(confirm(`确定要删除预约订单"${n.order_no}"吗？此操作不可恢复！`))try{const t=await I({url:`/api/admin/appointments/${n.id}`,method:"DELETE"});t.code===200?(alert("删除成功"),U(),f()):alert(t.message||"删除失败")}catch(t){console.error("删除失败:",t),alert("删除失败")}}function H(){M.value=!1,a.value=null}function A(){z.value=!1,w.value=null,g.value="",D.value=""}function de(n){switch(n){case"pending":return"mdi:clock-outline";case"confirmed":return"mdi:calendar-check";case"completed":return"mdi:check-circle-outline";case"cancelled":return"mdi:close-circle-outline";default:return"mdi:help-circle"}}function q(n){switch(n){case"pending":return"待确认";case"confirmed":return"已确认";case"completed":return"已完成";case"cancelled":return"已取消";default:return"未知"}}function B(n){return n?new Date(n).toLocaleDateString("zh-CN"):"-"}function J(n){return n?new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function b(n){return n?parseFloat(n).toFixed(2):"0.00"}return(n,t)=>(o(),i("div",pe,[t[56]||(t[56]=e("div",{class:"page-header"},[e("h1",null,"预约管理"),e("p",null,"管理所有用户的预约订单")],-1)),e("div",_e,[e("div",{class:y(["stat-card total",{active:_.value==="all"}]),onClick:t[0]||(t[0]=s=>$("all"))},[c(d(u),{icon:"mdi:calendar-multiple",class:"stat-icon"}),e("div",fe,[e("div",ge,l(C.value.all||0),1),t[15]||(t[15]=e("div",{class:"stat-label"},"全部预约",-1))])],2),e("div",{class:y(["stat-card pending",{active:_.value==="pending"}]),onClick:t[1]||(t[1]=s=>$("pending"))},[c(d(u),{icon:"mdi:clock-outline",class:"stat-icon"}),e("div",ye,[e("div",be,l(C.value.pending||0),1),t[16]||(t[16]=e("div",{class:"stat-label"},"待确认",-1))])],2),e("div",{class:y(["stat-card confirmed",{active:_.value==="confirmed"}]),onClick:t[2]||(t[2]=s=>$("confirmed"))},[c(d(u),{icon:"mdi:calendar-check",class:"stat-icon"}),e("div",he,[e("div",ke,l(C.value.confirmed||0),1),t[17]||(t[17]=e("div",{class:"stat-label"},"已确认",-1))])],2),e("div",{class:y(["stat-card completed",{active:_.value==="completed"}]),onClick:t[3]||(t[3]=s=>$("completed"))},[c(d(u),{icon:"mdi:check-circle-outline",class:"stat-icon"}),e("div",Ce,[e("div",we,l(C.value.completed||0),1),t[18]||(t[18]=e("div",{class:"stat-label"},"已完成",-1))])],2),e("div",{class:y(["stat-card cancelled",{active:_.value==="cancelled"}]),onClick:t[4]||(t[4]=s=>$("cancelled"))},[c(d(u),{icon:"mdi:close-circle-outline",class:"stat-icon"}),e("div",De,[e("div",Te,l(C.value.cancelled||0),1),t[19]||(t[19]=e("div",{class:"stat-label"},"已取消",-1))])],2)]),e("div",Se,[e("div",xe,[c(d(u),{icon:"mdi:magnify",class:"search-icon"}),T(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>h.value=s),placeholder:"搜索订单号、用户名、宠物名...",onKeyup:re(O,["enter"])},null,544),[[X,h.value]]),e("button",{class:"search-btn",onClick:O},"搜索")]),e("div",$e,[e("div",Ie,[e("label",Ne,[T(e("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=s=>S.value=s),onChange:ee},null,544),[[ve,S.value]]),c(d(u),{icon:"mdi:calendar-today",class:"checkbox-icon"}),t[20]||(t[20]=m(" 只看今日预约 ",-1))])]),e("div",Ve,[t[22]||(t[22]=e("label",null,"动物种类：",-1)),T(e("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>k.value=s),onChange:te},[...t[21]||(t[21]=[e("option",{value:""},"全部",-1),e("option",{value:"猫"},"猫",-1),e("option",{value:"狗"},"狗",-1)])],544),[[L,k.value]])]),e("button",{class:"clear-filter-btn",onClick:se},[c(d(u),{icon:"mdi:filter-remove"}),t[23]||(t[23]=m(" 清除筛选 ",-1))])])]),F.value?(o(),i("div",Ae,[c(d(u),{icon:"mdi:loading",class:"spin"}),t[24]||(t[24]=e("span",null,"加载中...",-1))])):P.value.length===0?(o(),i("div",Pe,[c(d(u),{icon:"mdi:calendar-blank",class:"empty-icon"}),t[25]||(t[25]=e("h3",null,"暂无预约",-1)),Z.value?(o(),i("p",Fe,"当前筛选条件下没有预约记录")):(o(),i("p",Me,"暂无用户预约记录"))])):(o(),i("div",ze,[e("table",Ee,[t[27]||(t[27]=e("thead",null,[e("tr",null,[e("th",null,"订单号"),e("th",null,"用户信息"),e("th",null,"宠物信息"),e("th",null,"预约时间"),e("th",null,"服务项目"),e("th",null,"金额"),e("th",null,"状态"),e("th",null,"操作")])],-1)),e("tbody",null,[(o(!0),i(K,null,R(P.value,s=>(o(),i("tr",{key:s.id},[e("td",Ue,[e("span",null,l(s.order_no),1),e("small",null,l(B(s.created_at)),1)]),e("td",null,[e("div",qe,[c(d(u),{icon:"mdi:account-circle",class:"user-icon"}),e("div",null,[e("div",Be,l(s.user_name||"用户"+s.user_id),1),s.user_phone?(o(),i("div",Le,l(s.user_phone),1)):(o(),i("div",Ke,"ID: "+l(s.user_id),1))])])]),e("td",null,[e("div",Re,[c(d(u),{icon:s.pet_type==="狗"?"mdi:dog":"mdi:cat",class:"pet-icon"},null,8,["icon"]),e("div",null,[e("div",Ge,l(s.pet_name||"未命名宠物"),1),e("div",Oe,l(s.pet_type||"未知"),1)])])]),e("td",null,[e("div",je,[e("div",He,l(B(s.appointment_date)),1),e("div",Je,l(s.time_slot),1)])]),e("td",null,[e("div",Qe,[e("div",We,l(s.service_name||"洗护服务"),1),s.special_notes?(o(),i("div",{key:0,class:"special-notes",title:s.special_notes},[c(d(u),{icon:"mdi:note-text"}),t[26]||(t[26]=m(" 有备注 ",-1))],8,Xe)):v("",!0)])]),e("td",Ye,"¥"+l(b(s.order_total_amount)),1),e("td",null,[e("span",{class:y(["status-badge",s.status])},[c(d(u),{icon:de(s.status)},null,8,["icon"]),m(" "+l(q(s.status)),1)],2)]),e("td",null,[e("div",Ze,[e("button",{class:"action-btn view",onClick:Q=>ne(s.id),title:"查看详情"},[c(d(u),{icon:"mdi:eye"})],8,et),e("button",{class:"action-btn edit",onClick:Q=>ae(s),title:"修改状态"},[c(d(u),{icon:"mdi:pencil"})],8,tt),e("button",{class:"action-btn delete",onClick:Q=>ie(s),title:"删除"},[c(d(u),{icon:"mdi:delete"})],8,st)])])]))),128))])])])),V.value>0?(o(),i("div",lt,[e("div",nt,[t[29]||(t[29]=e("span",null,"每页显示",-1)),T(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>N.value=s),onChange:le},[...t[28]||(t[28]=[e("option",{value:5},"5 条",-1),e("option",{value:10},"10 条",-1),e("option",{value:20},"20 条",-1),e("option",{value:50},"50 条",-1)])],544),[[L,N.value,void 0,{number:!0}]])]),e("div",at,[e("button",{disabled:p.value===1,onClick:t[9]||(t[9]=s=>j(p.value-1))},"上一页",8,ot),e("span",it,"第 "+l(p.value)+" / "+l(G.value)+" 页，共 "+l(V.value)+" 条",1),e("button",{disabled:p.value>=G.value,onClick:t[10]||(t[10]=s=>j(p.value+1))},"下一页",8,dt)])])):v("",!0),M.value?(o(),i("div",{key:4,class:"dialog-overlay",onClick:H},[e("div",{class:"dialog large",onClick:t[11]||(t[11]=Y(()=>{},["stop"]))},[e("div",ut,[t[30]||(t[30]=e("h3",null,"预约详情",-1)),e("button",{class:"close-btn",onClick:H},[c(d(u),{icon:"mdi:close"})])]),E.value?(o(),i("div",ct,[c(d(u),{icon:"mdi:loading",class:"spin"}),t[31]||(t[31]=e("span",null,"加载中...",-1))])):a.value?(o(),i("div",rt,[e("div",vt,[e("h4",null,[c(d(u),{icon:"mdi:information-outline"}),t[32]||(t[32]=m(" 基本信息",-1))]),e("div",mt,[e("div",pt,[t[33]||(t[33]=e("label",null,"订单号：",-1)),e("span",null,l(a.value.orderNo),1)]),e("div",_t,[t[34]||(t[34]=e("label",null,"预约状态：",-1)),e("span",{class:y(["status-badge",a.value.status])},l(q(a.value.status)),3)]),e("div",ft,[t[35]||(t[35]=e("label",null,"用户ID：",-1)),e("span",null,l(a.value.userId),1)]),e("div",gt,[t[36]||(t[36]=e("label",null,"预约时间：",-1)),e("span",null,l(B(a.value.appointmentDate))+" "+l(a.value.timeSlot),1)]),e("div",yt,[t[37]||(t[37]=e("label",null,"创建时间：",-1)),e("span",null,l(J(a.value.createdAt)),1)]),e("div",bt,[t[38]||(t[38]=e("label",null,"最后更新：",-1)),e("span",null,l(J(a.value.updatedAt)),1)])])]),e("div",ht,[e("h4",null,[c(d(u),{icon:"mdi:paw"}),t[39]||(t[39]=m(" 宠物信息",-1))]),e("div",kt,[e("div",Ct,[c(d(u),{icon:a.value.petType==="狗"?"mdi:dog":"mdi:cat"},null,8,["icon"])]),e("div",wt,[e("div",Dt,l(a.value.petName||"未命名宠物"),1),e("div",Tt,[e("span",null,l(a.value.petType||"未知"),1),a.value.breed?(o(),i("span",St,"品种："+l(a.value.breed),1)):v("",!0),a.value.personality?(o(),i("span",xt,"性格："+l(a.value.personality),1)):v("",!0)])])])]),e("div",$t,[e("h4",null,[c(d(u),{icon:"mdi:spa"}),t[40]||(t[40]=m(" 服务项目",-1))]),(o(!0),i(K,null,R(a.value.services,s=>(o(),i("div",{key:s.serviceId,class:"service-item"},[e("div",It,[e("div",Nt,l(s.serviceName),1),e("div",Vt,"¥"+l(b(s.finalPrice)),1)]),s.description?(o(),i("div",At,l(s.description),1)):v("",!0),e("div",Pt,[e("span",null,"分类："+l(s.category),1),e("span",null,"时长："+l(s.duration)+"分钟",1),s.discountPercentage>0?(o(),i("span",Ft,"折扣："+l(s.discountPercentage)+"%",1)):v("",!0)])]))),128))]),a.value.careItems&&a.value.careItems.length>0?(o(),i("div",Mt,[e("h4",null,[c(d(u),{icon:"mdi:heart-pulse"}),t[41]||(t[41]=m(" 护理项目",-1))]),e("div",zt,[(o(!0),i(K,null,R(a.value.careItems,s=>(o(),i("div",{key:s.id,class:"care-item"},[e("div",Et,[e("div",Ut,l(s.careName),1),e("div",qt,"¥"+l(b(s.unitPrice)),1)]),s.description?(o(),i("div",Bt,l(s.description),1)):v("",!0),e("div",Lt,"分类："+l(s.careCategory),1)]))),128))])])):v("",!0),e("div",Kt,[e("h4",null,[c(d(u),{icon:"mdi:cash-multiple"}),t[42]||(t[42]=m(" 金额汇总",-1))]),e("div",Rt,[e("div",Gt,[t[43]||(t[43]=e("span",null,"基础服务费：",-1)),e("span",null,"¥"+l(b(a.value.itemsBaseTotal)),1)]),e("div",Ot,[t[44]||(t[44]=e("span",null,"服务折扣：",-1)),e("span",null,"-¥"+l(b(a.value.itemsDiscountTotal)),1)]),e("div",jt,[t[45]||(t[45]=e("span",null,"护理项目：",-1)),e("span",null,"¥"+l(b(a.value.careItemsTotal)),1)]),e("div",Ht,[t[46]||(t[46]=e("span",null,"订单总金额：",-1)),e("span",null,"¥"+l(b(a.value.orderTotalAmount)),1)])])]),a.value.specialNotes||a.value.cancellationReason?(o(),i("div",Jt,[e("h4",null,[c(d(u),{icon:"mdi:note-text"}),t[47]||(t[47]=m(" 备注信息",-1))]),a.value.specialNotes?(o(),i("div",Qt,[t[48]||(t[48]=e("label",null,"特殊要求：",-1)),e("p",null,l(a.value.specialNotes),1)])):v("",!0),a.value.cancellationReason?(o(),i("div",Wt,[t[49]||(t[49]=e("label",null,"取消原因：",-1)),e("p",null,l(a.value.cancellationReason),1)])):v("",!0)])):v("",!0)])):v("",!0)])])):v("",!0),z.value?(o(),i("div",{key:5,class:"dialog-overlay",onClick:A},[e("div",{class:"dialog",onClick:t[14]||(t[14]=Y(()=>{},["stop"]))},[e("div",Xt,[t[50]||(t[50]=e("h3",null,"修改预约状态",-1)),e("button",{class:"close-btn",onClick:A},[c(d(u),{icon:"mdi:close"})])]),e("div",Yt,[e("div",Zt,[e("div",es,[t[51]||(t[51]=e("label",null,"订单号：",-1)),e("span",null,l(w.value?.order_no),1)]),e("div",ts,[t[52]||(t[52]=e("label",null,"当前状态：",-1)),e("span",{class:y(["status-badge",w.value?.status])},l(q(w.value?.status)),3)])]),e("div",ss,[t[54]||(t[54]=e("label",null,[m("新状态 "),e("span",{class:"required"},"*")],-1)),T(e("select",{"onUpdate:modelValue":t[12]||(t[12]=s=>g.value=s),required:""},[...t[53]||(t[53]=[e("option",{value:"pending"},"待确认",-1),e("option",{value:"confirmed"},"已确认",-1),e("option",{value:"completed"},"已完成",-1),e("option",{value:"cancelled"},"已取消",-1)])],512),[[L,g.value]])]),g.value==="cancelled"?(o(),i("div",ls,[t[55]||(t[55]=e("label",null,[m("取消原因 "),e("span",{class:"required"},"*")],-1)),T(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=s=>D.value=s),rows:"3",placeholder:"请输入取消原因...",required:""},null,512),[[X,D.value]])])):v("",!0),e("div",ns,[e("button",{type:"button",class:"cancel-btn",onClick:A},"取消"),e("button",{type:"button",class:"submit-btn",onClick:oe,disabled:x.value},[x.value?(o(),me(d(u),{key:0,icon:"mdi:loading",class:"spin"})):v("",!0),m(" "+l(x.value?"保存中...":"确认修改"),1)],8,as)])])])])):v("",!0)]))}},us=ue(os,[["__scopeId","data-v-e51bd470"]]);export{us as default};
